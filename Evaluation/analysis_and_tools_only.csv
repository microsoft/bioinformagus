id,date,title,content,upvote_count,author_id,extracted_keywords,answer_content,answer_upvote_count,category_type,agg_type
9535219,2022-08-18,Nextflow printing help message even when params.help is false,"Hi Everyone. I was trying to add help section to my nextflow script as given below:pre><code class=""lang-bash"">nextflow.enable.dsl=2params.ref = ""resources/sequence.fasta""params.outdir=""results/00_indexes""params.runidx=""bwa""params.help = false    // Help Sectionlog.info """"""Step 0: Indexing=============================================Usage:    nextflow run idx.nf --ref ${params.ref} --outdir ${params.outdir} --runidx ${params.runidx}Input:    * --ref: Path of reference file. Defult [${params.ref}]    * --outdir: name of output directory. Default [${params.outdir}]    * --runidx: Name of tool to run indexing. Valid values are ""bwa"" and ""dragmap"". Default [${params.runidx}]""""""process DRAGMAPINDEX{    publishDir ""$params.outdir"", mode: 'copy'    input:    path (fasta)    output:    path ""*""    script:    """"""    mkdir dragmapidx    cp $fasta dragmapidx/    samtools faidx dragmapidx/$fasta     gatk CreateSequenceDictionary -R dragmapidx/$fasta      dragen-os --build-hash-table true --ht-reference dragmapidx/$fasta  --output-directory dragmapidx --ht-num-threads 20    gatk ComposeSTRTableFile -R dragmapidx/$fasta -O dragmapidx/str_table.tsv    """"""}process BWAINDEX{    publishDir ""$params.outdir"", mode: 'copy'    input:    path (fasta)    output:    path ""*""    script:    """"""    mkdir bwaidx    cp $fasta bwaidx/    bwa index bwaidx/$fasta    gatk CreateSequenceDictionary -R bwaidx/$fasta    samtools faidx bwaidx/$fasta    """"""}fa_ch=Channel.fromPath(params.ref, checkIfExists: true)if (params.help) {    log.info 'This is test pipeline'    exit 0}workflow {if (""${params.runidx}"" == ""bwa""){ BWAINDEX(fa_ch)} else if (""${params.runidx}"" == ""dragmap""){  DRAGMAPINDEX(fa_ch)  } else {  exit 1,  ""Invalid argument passed to --runidx""  }}/code></pre>This  pipeline behaves nicely when I run it with <code>nextflow run idx.nf --help</code> however it still prints the help message when I run <code>nextflow run idx.nf</code>. That is unnecessary printing of help section.pre><code>N E X T F L O W  ~  version 21.10.6Launching `idx.nf` [tender_monod] - revision: 5342c1bda0Step 0: Indexing=============================================Usage:    nextflow run idx.nf --ref resources/sequence.fasta --outdir results/00_indexes --runidx bwaInput:    * --ref: Path of reference file. Defult [resources/sequence.fasta]    * --outdir: name of output directory. Default [results/00_indexes]    * --runidx: Name of tool to run indexing. Valid values are ""bwa"" and ""dragmap"". Default [bwa]executor &gt;  local (1)[ce/99a3c5] process &gt; BWAINDEX (1) [100%] 1 of 1 ✔/code></pre>",1,48122,"nextflow, align, bwa, alignment","there is no reserved word for 'help'. This is just another key of the associative map 'params'. So , just test the variable like for a regular programming language.pre><code>if( params.help ) {log.info """"""Step 0: Indexing=============================================Usage:    nextflow run idx.nf --ref ${params.ref} --outdir ${params.outdir} --runidx ${params.runidx}Input:    * --ref: Path of reference file. Defult [${params.ref}]    * --outdir: name of output directory. Default [${params.outdir}]    * --runidx: Name of tool to run indexing. Valid values are ""bwa"" and ""dragmap"". Default [${params.runidx}]""""""    exit 0}/code></pre>",5,"analysis, tool",analysis_and_tool
395057,2019-08-20,Stop BWA from storing unmapped reads,"I am currently using BWA-MEM to map metagenomic reads to a small (~12kb) virus reference genome for a large number of samples. I have a lot of reads per sample - upwards of 10 million.The majority of the reads (~99%) do not match my reference - I am not interested in analysing these reads. However, the .sam file that BWA-MEM produces stores the unmapped reads, and I am stuck with these huge files that are taking up disk space (I do convert these into sorted .bam files and delete the .sam file, but they're still huge). Is there any way to stop BWA-MEM from storing the unmapped reads in the .sam file and only keep the mapped reads? Thank you for letting me know.",2,25073,"bwa, alignment","<pre class=""pre""><code class=""language-bash"">bwa mem (...) | samtools view -F 4 -o onlyMapped.bam/code></pre>See <a rel=""nofollow"" href=""http://broadinstitute.github.io/picard/explain-flags.html"">http://broadinstitute.github.io/picard/explain-flags.html</a> ",5,"analysis, tool",analysis_and_tool
364089,2019-02-14,bwa: fail to locate the index files,"Hi all,I'm trying to align a fastq file to a reference fasta file using bwa mem and for the life of me I keep getting the following error message. Any thoughts? Thanks!pre class=""pre""><code class=""language-bash"">bwa index -a bwtsw myref.fasta -p myrefls/code></pre>blockquote>  <pre class=""pre""><code class=""language-bash"">myref.amb  myref.bwt  myref.pacmyref.ann  myref.fasta    myref.sa  </code></pre>/blockquote>pre class=""pre""><code class=""language-bash"">bwa mem -M 1 -R '@RG\tID:{foo}.{bar}\tPU:{foo}.{bar}.{999999}\tSM:{999999}\tPL:{foo}\tLB{bar}' myref myfastq.fastq.gz[E::bwa_idx_load_from_disk] fail to locate the index files/code></pre>",1,52541,"alignment, bwa","I am not sure, but I think the cause of the error is the <code>-M</code> parameter doesn't take any values:blockquote>  <pre class=""pre""><code class=""language-bash"">         -M        Mark shorter split hits as secondary (for Picard compatibility).  </code></pre>/blockquote>Try with:pre class=""pre""><code class=""language-bash"">bwa mem -M -R '@RG\tID:{foo}.{bar}\tPU:{foo}.{bar}.{999999}\tSM:{999999}\tPL:{foo}\tLB{bar}' myref myfastq.fastq.gz/code></pre>",3,"analysis, tool",analysis_and_tool
6118,2011-03-04,Hmmbuild: How To Choose The Best Alignment For Hmm Model,"Hi,I wonder whether it's better to remove weakly aligned parts of proteins from MSA or keep them for building HMM?Case: Let's say I have a bunch of homologs and I want to generate HMM (hidden Markov-model) to be able to detect their homologs from distinct species. Questions:ol>li>Shall I use all available homologs or there is some reasonable limit (min: 5 or 15? max: 50, 100, 200)? I keep in mind that alignment gets worse the more sequnce is incorporate, plus MSA software has their limitations as well.</li>li>Which MSA program will you recommend? Personally, I like MUSCLE a lot, but I'm aware MAFFT or T-Coffee perform better (but slower).</li>li>Or shall I use more aligners and used consistency based alignment (M-coffee)?</li>li>Shall I trim badly align fragments (<a rel=""nofollow"" href=""http://trimal.cgenomics.org/"">trimAl</a> or <a rel=""nofollow"" href=""http://molevol.cmima.csic.es/castresana/Gblocks.html1.2.3."">gBlocks</a>)? </li>/ol>Cheers,",7,950,"hmm, hmmer, alignment","Unless your protein be something new, the best way to proceed is by looking for pre-aligned manually seeds in places like <a rel=""nofollow"" href=""http://pfam.sanger.ac.uk/"">Pfam</a> or Kadher Shameer's <a rel=""nofollow"" href=""http://caps.ncbs.res.in/3pfdb/"">3PFDB</a>. With a seed in hand, you don't need to align from scratch. And you could use it to search for homologs at a specified distance. Remember that packages like hmmbuild down-weight closely related sequences and up-weight distant ones during hmm building. So, you must select mostly distant candidates. Keep a few close ones just to sustain a little bit more of homology signal.The main question is: which aligment tool should I use? Well, if you have a seed then most aligners will return pretty the same result after a realigment. But, aligning from scratch can be painful. I do recommend <a rel=""nofollow"" href=""http://www.ebi.ac.uk/goldman-srv/webprank/"">PRANK</a> which is phylogeny-aware or ClustalW with iterate each step option turned on (very, very, very slow but way more reliable).Anyway you should consider the Pfam approach, i.e., searching piece by piece ((sub)domain, motifs, etc.). I've used this to reannotate selenoproteins in Kinetoplastida and was able to find things that even JGI crew missed.",6,"analysis, tool",analysis_and_tool
11534,2011-08-29,Can´T Find The Snps With Samtools (Only Get Indels),"Hello everybody, Could anyone tell me how to get SNPs using <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">SAMtools</a>???. I am learning how to do it but can´t get the SNPs, I only get the Indels. I am working with a mutant I created from an E coli genome (just for practice). The mutant was created with 5 mismatches, 5 insertions and 5 deletions (using Biopieces). The lenght and coverage is here: pre><code>read_fasta -i  &lt;fasta ref genome&gt;.fna | shred_seq -s 100 -c 50 | add_ident -k SEQ_NAME | write_fasta -x -o  &lt;rrreads&gt;.fna/code></pre>The alignment was made with <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> . Then I used <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">SAMtools</a> protocol (as described in some of the posts) like this : pre><code>samtools mpileup -uf &lt;refgenome&gt;.fasta result.sort.bam &gt; results.bcf/code></pre>and then , pre><code>bcftools view -vcg results.bcf - &gt; test.vcf/code></pre>If anyone can help me .. Thanks!!! :)",3,2549,"snp, indel, samtools, alignment","First simple thing to try: <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">samtools</a> mpileup -Buf.  Sometimes, the BAQ calculations will wrongly believe real SNPs to be undiagnosed indels, and will drop their quality in the pileup step such that they can't be called as SNPsSince you know where your missing SNPs are, look at them in the pileup text file.  If the SNP is detected, but the quality score is terrible, despite being fine in the .bams, that's what happened.",8,"analysis, tool",analysis_and_tool
326755,2018-07-13,BWA mem of a heavily masked reference index takes more time than the normal reference?,Hi everyoneI have a question regarding BWA mem alignmentI was interested in finding out the performance gains I would obtain from creating a artificial reference where I masked everything I was not interested in my panel.In short I blated all my regions of interest on my panel and created a masked fasta file of the Human hg19 where I masked with N anyregion that would not have some degree of sequence similarity to my regions of interest This basicaly masked around 90% of the human genome. I then created a BWA index with that masked fasta file and aligned my samples (that I had already previously done with the normal human reference) to see if there was any performance gains in terms of the time it took to align them.To my surprise the alignment against this much smaller reference (same length as the human genome but with over 90% of bases MAsked) was slower than the normal alignment against the hg19 assembly.Can someone tell me why this is?Many thanksDuarte,1,6120,"alignment, bwa","The masking doesnt make the reference genome smaller, it's the same basepair length. <br>What masking does however is let your reads possibly align in many more places. Every masked section could be a match to either end of your read. So rather than using BWA's intelligent ""seed"" technique to limit alignment time, you've forced it to look in many more places for candidate sites.I have seen this problem with GATK's HaplotypeCaller when looking near the centromere's run of many AAAA. The thing gets stuck in a loop trying millions of possible alignments for every read.",3,"analysis, tool",analysis_and_tool
125220,2014-12-30,Why there is huge difference in mapping quality with bwa & bowtie,"Hie NGS Geeks,Recently I observed some huge difference in mapping quality when aligned with bowtie &amp; bwa, after alignment I called variants using samtools mpileup. I thought someone might enlighten my knowledge about this, so my observations are1. With bowtie I got <strong>mapping quality 2 &amp; quality 6.98</strong> for particular position and when I called variants using samtools surprisingly it didn't report.Particular position in VCF file for reference:pre><code>SL2.50ch01      559045  .       G       .       6.98    .       DP=143;VDB=0.0001;AF1=1;AC1=2;DP4=0,0,64,71;MQ=2;FQ=-282        PL:DP27:135""/code></pre>ol>li>\but with bwa I got <strong>mapping quality 10 &amp; quality 78</strong> plus it reported variant i.e. alternate allele.</li>/ol>Particular position in VCF file for reference:pre><code>SL2.50ch01      559045  .       G       T       78      .       DP=58;VDB=0.0001;AF1=1;AC1=2;DP4=0,0,28,28;MQ=10;FQ=-196        GT:PL:DP:GQ   1/1:111,169,0:56:99""./code></pre>I think am not confusing anyone, if so please let me know &amp; thanks in advance",1,15466,"bowtie, bwa, next-gen, alignment, samtools","See section 3.3.2 in ""http://arxiv.org/pdf/1404.0929v1.pdf"" rel=""nofollow"">http://arxiv.org/pdf/1404.0929v1.pdf</a>",3,"analysis, tool",analysis_and_tool
308021,2018-04-06,Does samtools view only show reads that completely span the region?,"I've got a bam file of paired-end illumina sequences mapped to a reference sequence and I was wondering if when I call the samtools view command if the results represent only reads that completely span over the region of interest or if it also included reads that intersect it by one or two base pairs. If not are there any existing tools out there to <em>only</em> read thats completely span over the region of interest?with this visual example of what I mean I would want to only include sequences like case_2 and exclude case_1:pre class=""pre""><code class=""language-bash"">                                  [===================Region-of-Interest=====================]                 [---------------------------------------------------------------------------------------------------------] case_1                               [-------------------------------------------------------------------------------------------------------------------] case_2/code></pre>Thanks!",1,45960,"samtools, alignment, assembly, next-gen","<a rel=""nofollow"" href=""http://bedtools.readthedocs.io/en/latest/content/tools/intersect.html"">bedtools intersect</a> with -f 1.0 or -F 1.0 should do what you want. Something like:pre class=""pre""><code class=""language-bash"">bedtools intersect -F 1.0 -a intervarls.bed -b file.bam/code></pre>I am not an expert on bedtools, though, so you may have to tweak / correct this command.",3,"analysis, tool",analysis_and_tool
302401,2018-03-06,bcftools merge of multiple vcf produces duplicate records. How to solve the issue.,"I have multiple single-sample VCF files, which I want to merge into a single multi-sample VCF file. When using <code>bcftools merge</code> I am getting duplicate records. pre class=""pre""><code class=""language-bash"">$ bcftools merge ms01e_phased.vcf.gz ms02g_phased.vcf.gz ms03g_phased.vcf.gz ms04h_phased.vcf.gz MA605_phased.vcf.gz MA611_phased.vcf.gz -O v -o RBphased_variants.SixSamples.Final.vcf # duplicate records at the same lines from the file ""RBphased_variants.SixSamples.Final.vcf""2   14691373    .   A   .   1153.31 PASS    BaseQRankSum=2.02;ClippingRankSum=0;ExcessHet=3.0103;FS=1.098;InbreedingCoeff=-0.0861;MQ=58.74;MQRankSum=-2.459;QD=19.22;ReadPosRankSum=-0.466;SOR=0.96;DP=68;AN=8  GT:AD:DP:GQ:PL:PG:PB:PI:PW:PC:PM    0/0:4:4:0:0:0/0:.:.:0/0:.:. 0/0:7:7:18:0:0/0:.:.:0/0:.:.    0/0:4:4:12:0:0/0:.:.:0/0:.:.    0/0:2:2:3:0:0/0:.:.:0/0:.:. ./.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.2   14691373    .   A   AAG 1153.31 PASS    BaseQRankSum=2.02;ClippingRankSum=0;ExcessHet=3.0103;FS=1.098;InbreedingCoeff=-0.0861;MQ=58.74;MQRankSum=-2.459;QD=19.22;ReadPosRankSum=-0.466;SOR=0.96;set=InDels;DP=676;AF=0.042;AN=4;AC=0    GT:AD:DP:GQ:PGT:PID:PL:PG:PB:PI:PW:PC:PM    ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. 0/0:12,0:12:9:.:.:0,9,135:0/0:.:.:0/0:.:.   0/0:22,0:22:12:.:.:0,12,180:0/0:.:.:0/0:.:.2   14691374    .   A   .   1320.25 PASS    BaseQRankSum=-1.049;ClippingRankSum=0;ExcessHet=0.2929;FS=0;InbreedingCoeff=0.4006;MQ=55.35;MQRankSum=0;QD=33.01;ReadPosRankSum=-0.671;SOR=0.892;DP=44;AN=2 GT:AD:DP:GQ:PL:PG:PB:PI:PW:PC:PM    0/0:4:4:0:0:0/0:.:.:0/0:.:. ./.:7:7:.:0:./.:.:.:./.:.:. ./.:0:0:.:0:./.:.:.:./.:.:. ./.:0:0:.:0:./.:.:.:./.:.:. ./.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.2   14691374    .   A   G   1320.25 PASS    BaseQRankSum=-1.049;ClippingRankSum=0;ExcessHet=0.2929;FS=0;InbreedingCoeff=0.4006;MQ=55.35;MQRankSum=0;QD=33.01;ReadPosRankSum=-0.671;SOR=0.892;set=HignConfSNPs;DP=710;AF=0.115;MLEAC=3;MLEAF=0.115;AN=4;AC=0 GT:AD:DP:GQ:PGT:PID:PL:PG:PB:PI:PW:PC:PM    ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. ./.:.:.:.:.:.:.:.:.:.:.:.:. 0/0:12,0:12:9:.:.:0,9,135:0/0:.:.:0/0:.:.   0/0:22,0:22:12:.:.:0,12,180:0/0:.:.:0/0:.:./code></pre>I raised this issue in <code>bcftools</code> thinking if it was a bug <a rel=""nofollow"" href=""https://github.com/samtools/bcftools/issues/754"">https://github.com/samtools/bcftools/issues/754</a> . But, is there any other solution to the problem.",5,16199,"VCF, vcf merge, bcftools, duplicate records, variants","Hey kirannbishwa01,I would not call these duplicate records as they are different calls but at the same position.Just adding <code>--merge all</code> to your command should help to solve itSo:pre class=""pre""><code class=""language-bash"">bcftools merge --merge all ms01e_phased.vcf.gz ms02g_phased.vcf.gz ms03g_phased.vcf.gz ms04h_phased.vcf.gz MA605_phased.vcf.gz MA611_phased.vcf.gz -O v &gt; RBphased_variants.SixSamples.Final.vcf/code></pre>Kevin",13,"analysis, tool",analysis_and_tool
128967,2015-01-30,Remove mitochondrial reads from BAM files,"Hi,I have a somewhat high content of mitochondrial RNA in my RNA-seq experiment. Is there a way to use samtools to remove alignments to the 'MT' chromosome and keep all the rest?I'm considering using samtools view in combination with awk but perhaps there's a better/cleaner solution?Thanks!",11,5366,"awk, samtools, BAM, RNA-Seq","You can use samtools to do it by selecting particular chromosomes and never leaving the binary format, for example:pre class=""pre""><code class=""language-bash"">samtools view -b input.bam chr1 chr2 chr3 chr4 &gt; output.bam/code></pre>That's a bit unwieldy to list all non-mitochondrial chromosomes manually, so you could try an ugly bash one-liner like:pre class=""pre""><code class=""language-bash"">samtools idxstats input.bam | cut -f 1 | grep -v MT | xargs samtools view -b input.bam &gt; output.bam/code></pre>",31,"analysis, tool",analysis_and_tool
257570,2017-06-13,Difference between chimeric alignments and multiple mapping,"Hi all:I recently got quite confused with two SAM flags got from BWA alignment, which is ""<strong>supplementary alignment</strong>"" from chimeric alignments and ""<strong>not primary alignment</strong>"" (or ""secondary alignment"") from multiple mapping.strong>What samtools explain about these two flags is:</strong>(Refer to <a rel=""nofollow"" href=""https://samtools.github.io/hts-specs/SAMv1.pdf)"">https://samtools.github.io/hts-specs/SAMv1.pdf)</a>A chimeric alignment is primarily caused by structural variations, gene fusions, misassemblies, RNA-seq or experimental protocols. It is more frequent given longer reads. For a chimeric alignment, the linear alignments consisting of the alignment are largely non-overlapping. Typically, one of the linear alignments in a chimeric alignment is considered the ""representative"" alignment, and the others are called ""supplementary"" and are distinguished by the supplementary alignment flag.  In contrast, multiple mappings are caused primarily by repeats. They are less frequent given longer reads. If a read has multiple mappings, all these mappings are almost entirely overlapping with each other. In multiple mapping, One of these alignments is considered ""primary"". All the other alignments have the ""secondary"" alignment flag set in the SAM records that represent them.strong>However</strong>, I found in my ChIP-seq alignment results got from BWA(without -M option), alignments with ""supplementary"" flags are with overlaps with ""representative"" alignments,which I think should be ""secondary"" alignments as described. For example, I got four alignments for one pair of reads:HWI-C00135:237:CAR2BANXX:1:1101:6737:91207  163 chr6    144444720   60  61M40S  =   144444728   61  GTACACACATATACACAGTGCTAAGTTCATTGTACACACATATACACAGTGCTAACTTCATTGTACACACATATACACAGTGCTAAGTTCATTGTACACAC   BBBBBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF   NM:i:1  MD:Z:1C59   AS:i:59 XS:i:0  SA:Z:chr6,144444722,+,33S59M9S,60,2;HWI-C00135:237:CAR2BANXX:1:1101:6737:91207  2131    chr6    144444722   11  56H45M  =   144444720   -47 ACACACATATACACAGTGCTAAGTTCATTGTACACACATATACAC   FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBBBBB   NM:i:0  MD:Z:45 AS:i:45 XS:i:20 SA:Z:chr6,144444728,-,53M48S,11,0;HWI-C00135:237:CAR2BANXX:1:1101:6737:91207  2211    chr6    144444722   60  33H59M9H    =   144444728   59  ACACACATATACACAGTGCTAACTTCATTGTACACACATATACACAGTGCTAAGTTCAT FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF NM:i:2  MD:Z:22G30C5    AS:i:49 XS:i:0  SA:Z:chr6,144444720,+,61M40S,60,1;HWI-C00135:237:CAR2BANXX:1:1101:6737:91207  83  chr6    144444728   11  53M48S  =   144444720   -61 ATATACACAGTGCTAAGTTCATTGTACACACATATACACAGTGCTAACTTCATTGTACACACATATACACAGTGCTAAGTTCATTGTACACACATATACAC   FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBBBBB   NM:i:0  MD:Z:53 AS:i:53 XS:i:49 SA:Z:chr6,144444722,-,56S45M,11,0;The 2nd and 3rd alignment with ""2131"" and ""2211"" flags are as ""supplementary"" alignments, however, they are fragments of the other two full-length alignments. I didn't find any reads with ""secondary"" flags in my results, but all alignments with ""supplementary"" flags I checked are cases like what I show above.Can anyone help explain this? Should I remove these ""supplementary"" alignments to keep uniquely mapped reads? Thanks very much.Best,Vanilla",7,21634,"sequencing, alignment, sam, samtools, sam flag","Those are proper supplemental alignments, since there's no way to map the entire reads in a biologically coherent manner. A secondary alignment would occur if those reads mapped elsewhere in the genome (i.e., not overlapping like this).Anyway, yes, you can go ahead and remove those for most downstream applications. One caveat to this is that you might have a structural variation there (tandem repeat).",6,"analysis, tool",analysis_and_tool
256448,2017-06-06,Obtaining uniquely mapped reads from BWA mem alignment (filtering by q score does not seem to do the trick in my case),"Hello, I am pretty new to bioinformatics and to this forum, and would very much appreciate any suggestions you could offer to help me with ways to filter my alignments (obtained using bwa mem) so I only have uniquely mapped reads, other than using q scores (which I have already done and doesn't solve my problem)? Here is a bit more explanation: I am trying to obtain uniquely mapped reads from my bwa mem alignments to use in downstream analyses. I realize that ""uniquely mapped reads"" is a loaded term, and that most sources I have found on the topic suggest filtering by q score should do the trick. My problem is that I have tried filtering by progressively higher q scores and I still have a (very small) number of reads that appear to not be uniquely mapped. Because I am aligning my reads from each sample to 96 different loci (in bwa), I want to make sure my reads are only mapped to one locus. For the one sample I am using to test out commands, I filtered my data so I only have properly paired reads and mapped reads (in the case of my unpaired reads) and also filtered by q score (I get nearly the same results at q of 10, 20, or 30, so it's not an issue of changing the q score level), merged all my bam files, and obtained 193,998 reads total for that sample. When I open the bam file in Geneious and count the number of reads for each locus they add up to 194, 050. I realize the difference between these two numbers is an incredibly small number of reads, and I am going to only use loci that have ~20 or 30 mapped reads for each sample (haven't yet decided on that threshold) so maybe this doesn't matter terribly much in the grand scheme, but I still would like to have these two numbers match so I am not incorrectly including loci that weren't actually sequenced for a particular sample. I have also seen suggestions to filter by XT tags, but none of my files have this tag. I DO have the XS tag (most seem to be XS:i:0). My understanding of what XS:i:0 means is a bit shaky, but I think it means that the secondary alignment has a score of zero so these would be reads that only have one alignment? And maybe this could be a good tag to use for filtering? strong>So my question is this: Does anyone have any suggestions for other tags or filtering steps I can use for my data so that my reads only map to one location, other than filtering for q score (which I have already done and will do in addition to any other filtering steps)?</strong> Here is the applicable portion of code that I am running on alignments obtained from bwa (sorted them by coordinate and converted them to bam already in a previous step). The first line is what I'm using on my paired-end file and the second line is what I am using on my unpaired read 1 file (using the same code for my unpaired read 2 file). Note that I used trimmomatic to remove low quality bases from my reads, which is why I have three different read files for each sample. pre class=""pre""><code class=""language-bash"">samtools view -q 10 -f 0x02 -b pe001_sorted.bam &gt; pe001_sorted_properlypaired.bamsamtools view -q 10 -F 0x04 -b unpaired1_sorted.bam &gt; unpaired1_sorted_mapped.bam/code></pre>Thank you very much for any help you can offer!",5,39680,"next-gen, alignment, bwa","The XT tag was used by early versions of bwa but not bwa-mem, which is like the new version for all intents and purposes.The XT tag is mainly seen these days as the tag for marking adapter sequences in the GATK best practices workflow.Any tag that starts with an ""X"", ""Y"", or ""Z"" are user-defined, which means it's going to be unique to the tool that put them in the file. It's a real shame that tags have this 2-character limitation and can't just say what it is that they do, but meh. Bioinformatics amiright.The issue your having is most likely due to a totally non-intuitive aspect of the SAM format, where data is allowed to be wrong provided you can figure out that it's wrong. For example, a read can have ""mapped in a proper pair"" set, but if it's also unmapped, then you are supposed to recognise that the ""mapped in a proper pair == true"" is actually false.So long story short, you can't use 0x02 on it's own. You have to  say ""i don't want unmapped reads, and i do want properly paired reads"" which is -F 0x04 -f 0x02. As Devon points out you probably also want to get rid of secondary alignments, so the grand total is:pre class=""pre""><code class=""language-bash"">samtools view -q 10 -F 1284 -f 0x02 -b pe001_sorted.bam &gt; pe001_sorted_properlypaired.bam/code></pre>",5,"analysis, tool",analysis_and_tool
211541,2016-09-12,How to select aligned reads below certain mapping Quality (from BWA)?,"Samtools can be used to select reads above certain mapping quality. pre class=""pre""><code class=""language-bash"">samtools view -h -b -q 30 aligned.bam -o above.mapQ30.bam/code></pre>strong>But, how to select a read below certain mapping quality - all aligned reads below mapQ 30?</strong>I know it can be done using awk. But, the pipeline gets lengthy and time consuming when first need to convert bam to sam - separate header - use awk for mapQ below 30 - add header - sam file - convert to bam.Really, its taking a lots of time.Thanks,",3,16199,"bwa, bam, mapping quality, alignment, samtools","Use SAMtools with the -U flag to output reads that don't match your filter, e.g.blockquote>  samtools view -h -b -q 30 -U below_q30.bam aligned.bam/blockquote>",9,"analysis, tool",analysis_and_tool
211404,2016-09-12,where can I find more data about --outSAMattributes All?,"Hi,I came across this in STAR aligner:--outSAMattributes Allthe manual says it includes: NH HI AS NM NM MD jM jIwhere can I find what these mean?Thanks,",1,15670,"RNA-Seq, rna-seq, samtools, STAR","""Sequence Alignment/Map Optional Fields Specication"" <a rel=""nofollow"" href=""http://samtools.github.io/hts-specs/SAMtags.pdf"">http://samtools.github.io/hts-specs/SAMtags.pdf</a> ",4,"analysis, tool",analysis_and_tool
12475,2011-09-24,What Does Samtools Flagstat Results Mean?,"Hi,Once again, I'm bothering the knowledgeable people from this site :) I'm currently analyzing some RNAseq data from mouse, and after running TopHat on my paired-end files, I wanted to look at any form of program that could let me know how many reads from my dataset aligned, and how many of them properly aligned to the ref mouse genome annotation.After performing the <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">samtools</a> flagstat on the accepted hits <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">bam</a> file, I get the following:pre><code>20968800 + 0 in total (QC-passed reads + QC-failed reads)0 + 0 duplicates20968800 + 0 mapped (100.00%:nan%)20968800 + 0 paired in sequencing11431237 + 0 read19537563 + 0 read271098 + 0 properly paired (0.34%:nan%)6633306 + 0 with itself and mate mapped14335494 + 0 singletons (68.37%:nan%)0 + 0 with mate mapped to a different chr0 + 0 with mate mapped to a different chr (mapQ&gt;=5)/code></pre>I've been trying to look on how to interpret these numbers, and what does that properly paired (0.34%:nan%) means, but so far I haven't been lucky. I don't really know how to interpret the final flagstat output, and whether my alignment conditions worked at all.I'd appreciate any piece of information on this issue, thanks!!!!",26,2160,"rna, samtools, mouse","Here is the C code in <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">samtools</a>:pre class=""pre""><code class=""language-bash"">typedef struct {    long long n_reads[2], n_mapped[2], n_pair_all[2], n_pair_map[2], n_pair_good[2];    long long n_sgltn[2], n_read1[2], n_read2[2];    long long n_dup[2];    long long n_diffchr[2], n_diffhigh[2];} bam_flagstat_t; (...)    printf(""%lld + %lld in total (QC-passed reads + QC-failed reads)\n"", s-&gt;n_reads[0], s-&gt;n_reads[1]);    printf(""%lld + %lld duplicates\n"", s-&gt;n_dup[0], s-&gt;n_dup[1]);    printf(""%lld + %lld mapped (%.2f%%:%.2f%%)\n"", s-&gt;n_mapped[0], s-&gt;n_mapped[1], (float)s-&gt;n_mapped[0] / s-&gt;n_reads[0] * 100.0, (float)s-&gt;n_mapped[1] / s-&gt;n_reads[1] * 100.0);    printf(""%lld + %lld paired in sequencing\n"", s-&gt;n_pair_all[0], s-&gt;n_pair_all[1]);    printf(""%lld + %lld read1\n"", s-&gt;n_read1[0], s-&gt;n_read1[1]);    printf(""%lld + %lld read2\n"", s-&gt;n_read2[0], s-&gt;n_read2[1]);    printf(""%lld + %lld properly paired (%.2f%%:%.2f%%)\n"", s-&gt;n_pair_good[0], s-&gt;n_pair_good[1], (float)s-&gt;n_pair_good[0] / s-&gt;n_pair_all[0] * 100.0, (float)s-&gt;n_pair_good[1] / s-&gt;n_pair_all[1] * 100.0);    printf(""%lld + %lld with itself and mate mapped\n"", s-&gt;n_pair_map[0], s-&gt;n_pair_map[1]);    printf(""%lld + %lld singletons (%.2f%%:%.2f%%)\n"", s-&gt;n_sgltn[0], s-&gt;n_sgltn[1], (float)s-&gt;n_sgltn[0] / s-&gt;n_pair_all[0] * 100.0, (float)s-&gt;n_sgltn[1] / s-&gt;n_pair_all[1] * 100.0);    printf(""%lld + %lld with mate mapped to a different chr\n"", s-&gt;n_diffchr[0], s-&gt;n_diffchr[1]);    printf(""%lld + %lld with mate mapped to a different chr (mapQ&gt;=5)\n"", s-&gt;n_diffhigh[0], s-&gt;n_diffhigh[1]);(...)        ++(s)-&gt;n_reads[w];                                                \        if ((c)-&gt;flag &amp; BAM_FPAIRED) {                                    \            ++(s)-&gt;n_pair_all[w];                                        \            if ((c)-&gt;flag &amp; BAM_FPROPER_PAIR) ++(s)-&gt;n_pair_good[w];    \            if ((c)-&gt;flag &amp; BAM_FREAD1) ++(s)-&gt;n_read1[w];                \            if ((c)-&gt;flag &amp; BAM_FREAD2) ++(s)-&gt;n_read2[w];                \            if (((c)-&gt;flag &amp; BAM_FMUNMAP) &amp;&amp; !((c)-&gt;flag &amp; BAM_FUNMAP)) ++(s)-&gt;n_sgltn[w];    \            if (!((c)-&gt;flag &amp; BAM_FUNMAP) &amp;&amp; !((c)-&gt;flag &amp; BAM_FMUNMAP)) { \                ++(s)-&gt;n_pair_map[w];                                    \                if ((c)-&gt;mtid != (c)-&gt;tid) {                            \                    ++(s)-&gt;n_diffchr[w];                                \                    if ((c)-&gt;qual &gt;= 5) ++(s)-&gt;n_diffhigh[w];            \                }/code></pre>ul>li><code>[2]</code> is  an array of two elements storing the number of reads and the number of 'QC-failed reads'.</li>li>'NAN' means 'Not A Number' (e.g: div by 0)</li>li><code>n_reads</code> are the total number of reads</li>li><code>n_pair_all</code> : the read is paired in sequencing, no matter whether it is mapped in a pair</li>li><code>n_pair_good</code> : the read is mapped in a proper pair</li>li><code>n_read1</code> : count read1</li>li><code>n_read2</code> : count read2</li>li><code>n_sgltn</code> : the read itself is unmapped the mate is mapped</li>li><code>n_pair_map</code>: the read itself is mapped the mate is unmapped</li>li><code>n_diffchr</code>: number of reads with a mate mapped on a different chromosome</li>li><code>n_diffhigh</code>: number of reads with a mate  on a different chromosome having a quality greater than 5</li>/ul>for more information, see <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">the spec</a>",36,"analysis, tool",analysis_and_tool
198928,2016-06-27,Extracting reads mapped to any of multiple references,"I can extract reads mapped to a single reference sequence by first aligning the reads using, say, BWA, and processing with SAMtools:pre class=""pre""><code class=""language-bash"">samtools view -b -f 0x2 alignment.sam | samtools fastq - -1 mapped_1.fastq -2 mapped_2.fastq/code></pre>Is there a similar pipeline I can use to extract reads mapped to multiple references? That is, if a read was found in any of the given references, it should be included in the output. Here's an idea I have: ol>li>align the reads to each reference separately (producingmultiple SAM files)</li>li>extract the reads mapped to eachreference using the above pipeline</li>li><code>sort</code> and <code>uniq</code> the names of the reads from all output files, storing the names in file.txt</li>li><code>grep</code> the names in file.txt from one of the SAM files and store in a new SAM file</li>li>convert SAM to FASTQ </li>/ol>I'm guessing this is probably not the most efficient way to solve the problem. It also doesn't catch when a read might be mapped to one of the references without its pair. In this case, I'd like to extract both reads.",2,21568,"samtools, alignment","The most efficient way would be to map to all the references at once.  You can do this with any aligner if you just concatenate the references.  Alternatively you could map to all at once using BBSplit, which can produce one fastq output file per reference, containing all the reads (or pairs) that best map to that reference.  But if you simply want all reads that map to any reference in a single fastq file, along with their unmapped mates, you can do this:pre class=""pre""><code class=""language-bash"">1) Concatenate the references with cat.2) Map the reads with this command:bbmap.sh ref=references.fa in1=read1.fq.gz in2=read2.fq.gz outm=mapped.fq.gz outu=unmapped.fq.gz/code></pre>If one or both reads in a pair map to anything, both will go to ""outm""; if neither map, both will go to ""outu"".  The output files will be interleaved, but if you use ""outm1"" and ""outm2"" (and etc.) you can get the output in dual files.",3,"analysis, tool",analysis_and_tool
192253,2016-05-18,Keeping pheatmap colour range the same for different data sets,"Hi,I've got fold change data for samples 1 and 2 from time point t1 to time point t2. I want to create a heat map using pheatmap for subsets of genes (~50-100 per set) but I want to be able to define the colour scale to be the same for all.At the moment, R picks the range based on the highest fold change e.g. Heat map 1: this subset has a 200 fold  upregulation but no downregulation so 0 is blue and +200 is red. Heat map 2: this subset has 100 fold down regulation in one gene and only 2 fold upregulation for another, so the range will be -100 is blue and +2 is red. Is there a way that I can say +200 is always red and -100 is always blue and keep this range for all heat maps?Thanks.",6,23008,"R, RNA-Seq, pheatmap","This is sample code for the ALL dataset I downloaded from Bioconductor:pre class=""pre""><code class=""language-bash"">library(ALL)library(pheatmap)library(RColorBrewer)# Imports the sample expression datadata(""ALL"")expressionData = exprs(ALL)# Sets the minimum (0), the maximum (15), and the increasing steps (+1) for the color scale# Note: if some of your genes are outside of this range, they will appear white on the heatmapbreaksList = seq(0, 15, by = 1)# Plots the first heatmappheatmap(expressionData[1:10, ], # Plots the first 10 genes of the dataset         color = colorRampPalette(rev(brewer.pal(n = 7, name = ""RdYlBu"")))(length(breaksList)), # Defines the vector of colors for the legend (it has to be of the same lenght of breaksList)         breaks = breaksList) # Sets the breaks of the color scale as in breaksList# Plots the second heatmap with the same color and breaks optionspheatmap(expressionData[20:30, ], # Plots the third 10 genes of the dataset         color = colorRampPalette(rev(brewer.pal(n = 7, name = ""RdYlBu"")))(length(breaksList)),         breaks = breaksList)/code></pre>First heatmap <img src=""http://s32.postimg.org/ycaa1akcl/heat1.png"" alt=""enter image description here"">Second heatmap <img src=""http://s32.postimg.org/xsioeoqyt/heat2.png"" alt=""enter image description here""> ",13,"analysis, tool",analysis_and_tool
8237,2011-05-12,Workflow Or Tutorial For Snp Calling?,"I am looking for a good workflows, readings or tutorial for SNP calling. I read <a rel=""nofollow"" href=""http://biostar.stackexchange.com/questions/4277/a-workflow-of-population-genomic-operations-analysis-for-newcomers"">some</a> <a rel=""nofollow"" href=""http://biostar.stackexchange.com/questions/613/what-methods-do-you-use-for-in-del-snp-calling"">other</a> <a rel=""nofollow"" href=""http://biostar.stackexchange.com/questions/4277/a-workflow-of-population-genomic-operations-analysis-for-newcomers"">posts</a> on this topic, but I would like a more detailed explanation. Population genomics and sequence data are new to me (I have a general CS and biology background). It might just be me, but these tools are not as straightforward or as documented as I'd like. Any links or explanations would be good!So far, my situation is as follows:ul>    <li>I have Illumina sequence reads for a highly polymorphic species</li>    <li>I aligned these reads using <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> against a reference genome with default parameters, but I am not sure if I should change parameters (if so, which ones?) due to the highly polymorphic data</li>    <li>I am unsure of the next step, I will probably be using <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">SAMtools</a> or GATK... I tried making an mpile up but got really confused after that.</li>    <li>I should also be accessing SNP quality..what tools are used for that? I already see some sequencing errors when browsing the data.</li>/ul>As you can tell, I am totally new with this. It is pretty exciting so I want to learn and be able to do some of these things! Thanks in advance.edit: I also get so confused with some of the output, more detailed documentation on that would be nice as well!",65,1847,"snp, samtools, alignment, next-gen, sequencing","GATK is certainly the best variant caller and it's the difference is important because with indels in particular, they can be hugely different.I've spoken to a few people who have had issues with GATK so I've actually written a blog post with a workflow that works for GATK. The major issues seemed to be using GATK's best practices, particularly their add or replace read groups module which sometimes causes it to fall over later. By adding the read group (you can make it whatever you like) when you run bwa, then this workflow actually works.This was written for microbes so ploidy is set to 1 for HaplotypeCaller, but this can be set to whatever you like (do check the documentation). Originally posted here(""https://approachedinthelimit.wordpress.com/2015/10/09/variant-calling-with-gatk/"" rel=""nofollow"">https://approachedinthelimit.wordpress.com/2015/10/09/variant-calling-with-gatk/</a>)hr>ul>li>Dependencies:</li>/ul>You'll need to install picardtools, GATK, bwa and optionally, vcffilter for this workflow. Picardtools and GATK are simply .jar files so that's no problem while you probably already have bwa installed, otherwise installation is well documented!ul>li>The workflow</li>/ul>This workflow begins with short read (fastq) files and a fasta reference. First a sequence dictionary is created, short reads are aligned to the reference and read group information provided, resulting sequence alignment map (sam) file sorted and converted to binary alignment map (bam) format, duplicates marked, bam file sorted, indel targets identified, indels realigned and variants called. Simple!For simplicity an example set of commands are provided here, where the reference is reference.fasta and the short reads are R1.fastq.gz and R2.fastq.gz. You will need to enter the paths and versions of the software being used at each step and your actual file names.strong>Create sequence dictionary</strong>pre><code>java -jar~/bin/picard-tools-1.8.5/CreateSequenceDictionary.jar REFERENCE=reference.fasta OUTPUT=reference.dict/code></pre>strong>Align reads and assign read group</strong>pre><code>bwa mem -R ""@RG\tID:FLOWCELL1.LANE1\tPL:ILLUMINA\tLB:test\tSM:PA01"" reference.fasta R1.fastq.gz R2.fastq.gz &gt; aln.sam/code></pre>strong>Sort sam file</strong>pre><code>java -jar ~/bin/picard-tools-1.8.5/SortSam.jar I=aln.sam O=sorted.bam SORT_ORDER=coordinate/code></pre>strong>Mark duplicates</strong>pre><code>java -jar ~/bin/picard-tools-version/MarkDuplicates.jar I=sorted.bam O=dedup.bam METRICS_FILE=metrics.txt/code></pre>strong>Sort bam file</strong>pre><code>java -jar ~/bin/picard-tools-version/BuildBamIndex.jar INPUT=dedup.bam/code></pre>strong>Create realignment targets</strong>pre><code>java -jar ~/bin/GATK3.3/GenomeAnalysisTK.jar -T RealignerTargetCreator -R reference.fasta -I dedup.bam -o targetintervals.list/code></pre>strong>Indel realignment</strong>pre><code>java -jar ~/bin/GATK3.3/GenomeAnalysisTK.jar -T IndelRealigner -R PA01.fasta -I dedup.bam -targetIntervals targetintervals.list -o realigned.bam/code></pre>strong>Call variants (HaplotypeCaller)</strong>pre><code>java -jar ~/bin/GATK3.3/GenomeAnalysisTK.jar -T HaplotypeCaller -R reference.fasta -I realigned.bam -ploidy 1 -stand_call_conf 30 -stand_emit_conf 10 -o raw.vcf/code></pre>The resulting vcf file will contain your variant calls!Then you can optionally filter the variants:strong>Filter variants</strong>pre><code>~/bin/vcflib/bin/vcffilter -f 'DP &gt; 9' -f 'QUAL &gt; 10' raw.vcf &gt; filtered.vcf/code></pre>Or first split the raw.vcf file into SNPs and indels:strong>Extract SNPs</strong>pre><code>java -jar ~/bin/GATK3.3/GenomeAnalysisTK.jar -T SelectVariants -R reference.fasta -V raw.vcf -selectType SNP -o snps.vcf/code></pre>strong>Extract Indels</strong>pre><code>java -jar ~/bin/GATK/GenomeAnalysisTK.jar -T SelectVariants -R reference.fasta -V raw.vcf -selectType INDEL -o indels.vcf/code></pre>I also have a neat perl wrapper to automate this workflow over many short read files and would be happy to make this available if people are interested! Please do comment with any questions or issues and I'll do my best to resolve them!",19,"analysis, tool",analysis_and_tool
180076,2016-03-05,obtaining a pileup with read names from a  bam alignment,"Hi,I would like to obtain a pileup (from a bam file) that also includes the read names. samtools mpileup command only gives the bases: samtools mpileup --positions ctg2.bed  -f reference_genomic2.fasta  reads.bam  ctg2_left_rc    177692  C       53      ,,.,.,..,....,...,,,,.....,.............AAAAAAAAAaaaa   ]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]O]]]]]]]]]]]]]]]]]ctg2_left_rc    177721  T       55      ,,,.,.,<em>.,....,...,,,,....</em>,......<em>..</em>.*.CCCCCCCCCCcccc ]]]]]]]]]]]K]]]]]]]]]]]R]]]L]]]]]]]]]]]]]]]]]]]]N]]]]]]Checking in the IGV browser, I saw that samtools mpileup  correctly identified the deletions in the reads (with '*') Since I need the read names and could not find a suitable command in samtools, I  wrote a script in python, using  pysam (I am a newbie in both). However, it is not correctly handling indels, and instead of reporting them with '*' as samtools mpileup, it gives the previous base. My script follows; any suggestion will be greatly appreciated.the command line:samtools_view.py   --bam reads.bam  --fasta reference_genomic2.fasta  --chr ctg2_left_rc --start 177721 --end 177722the script:pre class=""pre""><code class=""language-bash"">#! /usr/local/bin/python2.7 import pysamimport argparseparser = argparse.ArgumentParser(description='usage: python samtools_view.py  --bam reads.bam --fasta reference_genomic.fasta  --chr ctg2_right --start 100140 --end 100142 ')parser.add_argument('--bam', help='Input bam file name',required=True)parser.add_argument('--fasta', help='Input reference fasta file name',required=True)parser.add_argument('--chr',help='target contig or chromosome', required=True)parser.add_argument('--start',help='target region start (bp)', required=True)parser.add_argument('--end',help='target region end (bp)', required=True)args = parser.parse_args()args.start = int(args.start) args.end = int(args.end)samfile = pysam.AlignmentFile(args.bam, ""rb"")fastafile = pysam.FastaFile( args.fasta )for pileupcolumn in samfile.pileup(args.chr, args.start, args.end):    for pileupread in pileupcolumn.pileups:        if (pileupcolumn.pos &gt;= args.start) and (pileupcolumn.pos &lt;= args.end):           print ('%s\t%s\t%s\t%s\t%s\t%s' %                 (args.chr,          pileupcolumn.pos,                     fastafile.fetch(args.chr,pileupcolumn.reference_pos -1,pileupcolumn.reference_pos), # -1 needed because pysam is 0-based and most programs (and human heads) are 1-based          pileupread.alignment.query_name,          pileupread.query_position,                    pileupread.alignment.query_sequence[pileupread.query_position -1]))samfile.close()fastafile.close()/code></pre>",1,24188,"alignment, next-gen, pysam, mpileup, samtools","Internally, <code>samtools mpileup</code> is also getting the wrong base. The difference is that it also checks something of the form:pre class=""pre""><code class=""language-bash"">if not pileupread.is_del and not pileupread.is_refskip:/code></pre>The deletion/splicing status can be checked and handled in this way. Note that you're not the first pysam user to get confused by this. This isn't really pysam's fault, it's just exposing the underlying C functions which work in this way.",3,"analysis, tool",analysis_and_tool
179056,2016-02-28,HISAT2 end-to-end and --no-spliced-alignment mode returns gapped alignments,"I ran HISAT2 (index built using a transcriptome multi fasta) intending that it won't perform gapped alignment. I use following script to run HISAT:pre class=""pre""><code class=""language-bash"">INDEX=./indices/hisat/transcriptomeFASTQ=$1OUTPUT=./transcriptome_aligned/$2.sam./software/hisat-0.1.6-beta/hisat \    -q \    -p 2 \    --no-spliced-alignment \    --end-to-end \    -x $INDEX \    -U $FASTQ \    -S $OUTPUT/code></pre>Should I still expect gapped alignment in my SAM file?I have records like this in the SAM output.pre class=""pre""><code class=""language-bash"">SRR2144041.255  0   YCL025C 274 255 16M1I33M    *   0   0   CAGGCTCAAGAACTAGAAAAAAAATGAAAGTTCGGACAACATAGGCGCTA  CCCFFFFFHHHHHJJJJJJJJJJJJJJJIJGIIIIJJJJJIJJIIJJJHH  AS:i:-8 XN:i:0  XM:i:0  XO:i:1  XG:i:1  NM:i:1  MD:Z:49 YT:Z:UU NH:i:1/code></pre>This shows that HISAT2 is still performing gapped alignment even with <code>--end-to-end</code> and <code>--no-splice-alignment</code> parameters.I'm trying to use the output SAM for <code>rsem-calculate-expression</code> but it returns following error due to presence of gapped alignment:pre class=""pre""><code class=""language-bash"">rsem-parse-alignments ./indices/rsem/rsem ./rsem_output/sample.temp/sample ./rsem_output/sample.stat/sample ./transcriptome_aligned/sample.bam 1 -tag XMRead SRR2144041.836747: RSEM currently does not support gapped alignments, sorry!""rsem-parse-alignments ./indices/rsem/rsem ./rsem_output/sample.temp/sample ./rsem_output/sample.stat/sample ./transcriptome_aligned/sample.bam 1 -tag XM"" failed! Plase check if you provide correct parameters/options for the pipeline!/code></pre>How do I make sure that HISAT2 doesn't perform gapped alignment? Should I filter the output for using <code>grep -v XO:i:0</code>?strong>EDIT:</strong> I checked RSEM manual and found that in order to avoid gapped alignments using Bowtie2, RSEM uses following Bowtie2 parameters:pre class=""pre""><code class=""language-bash"">--sensitive --dpad 0 --gbar 99999999 --mp 1,1 --np 1 --score-min L,0,-0.1/code></pre>I wonder what is the equivalent of <code>--gbar</code> in HISAT2Thanks",1,14410,"RNA-Seq, hisat, samtools, rsem","Solved it:Included following two parameters in HISAT2 run command to make gap opening and extension insanely difficult.pre class=""pre""><code class=""language-bash"">--rdg 10000,10000--rfg 10000,10000/code></pre>My HISAT2 script now looks like this:pre class=""pre""><code class=""language-bash"">INDEX=./indices/hisat/transcriptomeFASTQ=$1OUTPUT=./transcriptome_aligned/$2.sam./software/hisat-0.1.6-beta/hisat \    -q \    -p 2 \    --no-spliced-alignment \    --end-to-end \    --rdg 10000,10000 \    --rfg 10000,10000 \    -x $INDEX \    -U $FASTQ \    -S $OUTPUT/code></pre>Hope it helps, if anybody is trying to run RSEM downstream of HISAT2.This solution might not be foolproof. Improvements on this answer are invited.",5,"analysis, tool",analysis_and_tool
175946,2016-02-08,What's the precise definition for sensitivity and specificity for alignment?,"When we talk about the sensitivity and specificity for NGS read alignments, what do we really mean?For example, in ""http://bioinformatics.oxfordjournals.org/content/25/14/1754.abstract"" rel=""nofollow"">the BWA paper</a>, it talks about sensitivity. How would we define the true-positives and false-negatives? My guess (relative to a known genome):strong>TP</strong>: Number of reads that is aligned exactly and correctly (no gap, no mismatch)strong>FN</strong>: Number of reads fails to map but should be mapped (it comes from the known genome)Is my definition correct? Is this what we mean when we say <code>alignment sensitivity</code>? What about specificity? Can we define <code>specificity</code> for alignment (not mentioned in the BWA paper)?In other words, my question is about what we <strong>really</strong> mean when we talk about sensitivity and specificity in alignments.",1,16712,"genome, sequence, bwa, alignment","This is indeed a tricky question, because even the definition of ""aligned exactly and correctly"" is not that easy.If we simulated reads, than we know where they are from and how they were created, but what if (by chance) after introducing the random errors, mathematically the read maps better somewhere else? What if there are multiple mathematical best hits? <a rel=""nofollow"" href=""http://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-12-210"">This paper</a> has some further thoughts.",3,"analysis, tool",analysis_and_tool
166438,2015-11-19,Getting read counts per loci,How can I get the number of mapped reads for a particular region?code>samtools view -c -F 4 my.bam</code> gives me count in the entire bam file but I can't just add <code>-r Chr1:0:1000</code> to get reads in that region only.,1,21580,"bam, RNA-Seq, samtools","<pre class=""pre""><code class=""language-bash"">samtools view in.bam chr1:0-1000 | wc -l/code></pre>but better way is to do it with <a rel=""nofollow"" href=""http://bedtools.readthedocs.org/en/latest/content/tools/multicov.html"">bedtools</a> if you have many regions, for e.g like exon coordinates or peak coordinates, which is more efficient way for counting purpose.pre class=""pre""><code class=""language-bash"">bedtools multicov -bams aln1.bam [ aln2.bam aln3.bam . . ] -bed ivls-of-interest.bed/code></pre>",3,"analysis, tool",analysis_and_tool
165090,2015-11-09,Extract reads from bam/sam files using read id,"Hi,I have fastq header of 1000s of reads. I want to check presence all of those reads in another bam file. I have written following scriptpre><code>while IFS='' read -r line || [[ -n ""$line"" ]]; do samtools view accepted_hits.bam | grep $line ;done &lt; fastqHeaders.txt ;/code></pre>But this is taking too much time as my .bam file is too big. does anyone know faster way to do this.Kindly helpChirag",2,19328,"fastq, bam, samtools, alignment","use picard <strong>FilterSamReads</strong>: <a rel=""nofollow"" href=""https://broadinstitute.github.io/picard/command-line-overview.html"">https://broadinstitute.github.io/picard/command-line-overview.html</a>blockquote>  READ_LIST_FILE (File)    Read List File containing reads that will be included or excluded from the OUTPUT SAM or BAM file. Default value: null./blockquote>",6,"data_format, analysis, tool",analysis_and_tool
76893,2013-07-18,Bwa-Mem: Discriminate Between Reads Mapping Uniquely And Those Mapping In Multiple Positions,"In <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a>-MEM what's the best way to discriminate reads mapping uniquely from those mapping in multiple positions?The XT tags that we used in <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> are no longer available.We are thinking about classifying as uniques the reads having XS:i:0 (suboptimal alignment score of 0).Someone is also suggesting to use a difference threshold between AS and XS. This would require a somewhat heavier parsing of the file, but we can do that if the improvement of results is significant. Which of the two methods is better? Are there other, better approaches?",7,1969,"alignment, next-gen, bwa","As far as I know for a mapped read a mapping quality score of zero (column 5 in the <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">SAM</a> file)  is the main indicator that a read maps to multiple positions with the same score. ",8,"analysis, tool",analysis_and_tool
144890,2015-06-02,Ideal samtools view f/F flags,"I'm filtering my sam file using the following command:pre><code>samtools view -Sb -f 2 -F 256/code></pre>after doing some research I think I've figured out what the flags mean (correct me if I'm wrong).code>-f 2</code> is keeping only reads that are ""properly aligned according to the aligner""code>-F 256</code> is discarding ""secondary alignments""ol>li>I'm not really sure what ""properly aligned"" entails but is it maybe too stringent? Typically I've seen people use only <code>-F 4</code> to discard unmapped reads.</li>li>If I'm correct a secondary alignment is a second tier alignment in which the read that matches with a lesser score than some other read. If so, is discarding this reasonable or again too stringent?</li>/ol>I'm new to this so I'd really value some input on how to select these two flags. I've seen a wide variety/combinations of them used. My reads are paired end ones from WGS studies in yeast and E. coli and I'm using them to call SNPs/indels using freebayes.Thank you",2,8362,"alignment, samtools, wgs, next-gen-sequencing","By default, freeBayes ignores unmapped and secondary alignments, so there's no point in filtering them. I see little benefit in filtering improperly paired alignments, if there's are a bunch of them then they're likely correct.",3,"analysis, tool",analysis_and_tool
142968,2015-05-19,The CIGAR '=' op for 'sequence match' in SAM - how and why?,"Mostly a curiosity question but:ol>li>Is the cigar '=' op kept for backwards compatibility or some specific use-case?</li>li>Is there functionality within samtools for generating an altered cigar that distinguishes between matches and mismatches similar to <em>calmd/fillmd -e</em>?</li>/ol>The ""http://samtools.github.io/hts-specs/SAMv1.pdf"" rel=""nofollow"">SAM v1 specification</a> has a 'sequence match' op (=) within CIGAR field however, I haven't seen it used before and it isn't mentioned in ""http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2723002/#!po=41.6667"" rel=""nofollow"">the 2008 paper</a>. I know that you can alter the SEQ field and replace exact matches with '=' using the <code>-e</code> option in samtools fillmd/calmd and that it would be relatively trivial to whip up something to do something like this manually. I've had a search around but haven't seen an example of it being used yet, though this may be due to the difficulty of searching for '=' online! Is the op '=' kept for backwards compatibility or a specific use-case? I vaguely remember someone saying on here (though I can't find a reference for it right now) that it was meant for read to genome comparisons - anyone have a reference for this?",1,12708,"sam, snp, samtools, alignment, next-gen","<code>=</code> and <code>X</code> are actually the newer CIGAR operations (they were added in version 1.4 of the spec., if I remember correctly), M is the older variant. Most tools still don't produce alignments with <code>=</code> or <code>X</code> operations, though it'd be kind of nice if they did. An exception to this is BBMap (and I believe STAR can be told to produce these).There is no functionality from within samtools to modify the CIGAR string like this, though I suppose this might be nice. As is, you tend to have to parse the MD auxiliary tag if you want mismatch information, which is kind of annoying in comparison.",3,"analysis, tool",analysis_and_tool
131333,2015-02-17,Does one need to sort and index after performing a rmdup in Samtools?,"Hi,I would like to know whether one needs to sort and to index the .bam files again after removing the duplicates in Samtools using <code>samtools rmdup -S</code>.I am under the impression that since we have already sorted and indexed the .bam files, and we are just removing the duplicates, there would be no need to do the sorting and indexing again. Am I wrong?Thanks in advance for your thoughts!",2,12667,"sequencing, alignment, samtools, variant","""sort""no: your bam is already sorted.""index""yes if you need to access some specific genomic regions in your bam. The previous index of the bam cannot be used with the new rmdup.bam",9,"analysis, tool",analysis_and_tool
117552,2014-10-30,How to get unmapped reads in a separate Fasta or Fastq file?,"Hi,I have some fastq files which I mapped to the host genome and get a sam file with 80% mapping rate. Now how can I get the unmapped reads to a separate fastq or fasta file so I can play with that only? Thank you very much everybody!",1,13312,"RNA-Seq, samtools, bowtie, tophat","Title of your question is different from content of question, anyways,So you ran tophat, and got bam files , both mapped and unmapped.and you want to extract reads from unmapped bam file in fastq format, you just run bamToFastq from bedtoolsHere is description from their manual :blockquote>bedtools bamtofastq (aka bamToFastq)Summary: Convert BAM alignments to FASTQ files.Usage:   <code>bamToFastq [OPTIONS] -i &lt;BAM&gt; -fq &lt;FQ&gt;</code>Options:<br>        -fq2    FASTQ for second end.  Used if BAM contains paired-end data.<br>                BAM should be sorted by query name is creating paired FASTQ.<br>        -tags   Create FASTQ based on the mate info                in the BAM R2 and Q2 tags.Tips:<br>      If you want to create a single, interleaved FASTQ file      for paired-end data, you can just write both to /dev/stdout:<br>      <code>bedtools bamtofastq -i x.bam -fq /dev/stdout -fq2 /dev/stdout &gt; x.ilv.fq</code>/blockquote>",3,"analysis, tool",analysis_and_tool
112364,2014-09-11,Finding Variants in BAM file reads with mpileup,"I'm new to the Bioinformatics field and am still learning how to use all the tools and such, but I've been stumped on something that I feel should be very easy for about a week.Basically, I want to compare the reads in a BAM file to a FASTA reference sequence and get the changes. I can easily view them with <strong>samtools tview</strong> but I need to have it in an Excel file for manipulation/concatenation. I can't seem to figure out why <strong>mpileup</strong> won't give me a straight list of what reads are mutated, unless that's the wrong tool for the job. I'm pretty good at programming, so if the solution is something I need to code for myself I could do it but since the formats are different than what I'm used to, it's been a major headache.Thanksimg alt=""What I'm dealing with"" src=""http://i.imgur.com/XR3F7xc.png"" style="""">",1,13525,"mpileup, samtools, SNP, variants","you need to use bcftools to generate a tabular VCF file:ul>li><a rel=""nofollow"" href=""http://samtools.sourceforge.net/mpileup.shtml"">http://samtools.sourceforge.net/mpileup.shtml</a> (old version)</li>li><a rel=""nofollow"" href=""http://www.htslib.org/workflow/#mapping_to_variant"">http://www.htslib.org/workflow/#mapping_to_variant</a> (new version)</li>/ul>PS: no, you don't want to have it in an Excel filePS2: no, you really don't want to have it in an Excel filePS3: Every time you want to have it in an Excel file, God kills a kittenPS4:img src=""https://i.ibb.co/9qnB04y/image.png"" width=""500"">",5,"analysis, tool",analysis_and_tool
98816,2014-04-24,BWA and SOAP2 cannot map a particular sequence which exists in the genome,"HiI have tried to map this short sequencepre><code>&gt;sample_1_x12179TCCTGTACTGAGCTGCCCCGA/code></pre>which exists on chr8 twice, using various aligners.BLAT, BLAST, and Bowtie2 found it. BWA MEM and SOAP2 did not. How come? BWA MEM finds it if I include some extra flanking bases. Is it because the sequence is too short?BWA MEM command:pre><code>bwa mem -t 8 $bwaIndex tmp.fasta/code></pre>SOAP command:pre><code>./soap2.20 \ -a tmp.fasta \ -o ${goutputfile}.tmp \ -D /mnt/NGS01/ReferenceDB/mirTools/db/genome/hsa.fa.index \ -M 0 -r 2 -v 5 -p 8 -l 15/code></pre>I also tried <code>-M 4</code> (find best hits), but still no results. If I remove the last two bases from the above sequence, then SOAP2 finds a hit on chr11 that requires 2 mismatches.Thank you.",1,6284,"alignment, bwa, soap2","BWA works for me (but <strong>not bwa mem</strong>, because it requires 70bp minimum query sequence length):pre class=""pre""><code class=""language-bash"">bwa aln $GRCh37 test.fa &gt; test.saibwa samse $GRCh37 test.sai test.fa &gt; test.samsample_1_x12179      16      8       41518003        0       21M     *       0 0TCGGGGCAGCTCAGTACAGGA   *       XT:A:R  NM:i:0  X0:i:2  X1:i:0  XM:i:0  XO:i:0  XG:i:0  MD:Z:21 XA:Z:8,+41517962,21M,0;_____________________________^_______________________________^^^/code></pre>The documentation for SOAP2 sucks, but I'm guessing it's an issue with your query read length.",3,"analysis, tool",analysis_and_tool
98432,2014-04-20,Bwa or bowtie for mapping mulitple genomes,"I have illumina paired-end whole-genome sequencing reads which I have map to around -400 reference plastid genomes. After getting mapped reads, I have to assemble as de novo plastid genome.1. Do I have map reads to invidiual reference genomes one by one, or can I download all genomes at one go and index as one reference genome?. Do bwa or bowtie has<br>enough memory to index 400 genomes as one reference index genome?2. Do you think which one is best method?. Mapping individual genome or all genomes indexed as one?3. If I have to map individually, can I combine all bam file together and Can I convert to fastq file using bam2fastq tool (in picard) for denovo assembly?",2,9582,"RNA-Seq, bwa, bowtie, mapping","<s>I don't fully understand your introductory sentence as stated, but I can answer your questions to the best of my understanding:</s>ol>li>You can concatenate all of your genomes into one large file and then index that composite genome. Just make sure your naming convention for each component in the FASTA is logical so that you can understand your results downstream. bwa and bowtie don't ""have their own memory,"" but if you're using a 64-bit system you shouldn't run into any size limitation troubles, especially with plastid sequences.</li>li><strong>EDIT:</strong> I say map to a single composite reference. You can pass parameters into bowtie to limit your mappings on the front end, thus saving computational time and making it easier to isolate the most accurate mappings for each read.</li>li>You can merge BAM files using <a rel=""nofollow"" href=""http://samtools.sourceforge.net/samtools.shtml"">samtools merge</a>, but of course you wouldn't need to if you proceed according to my recommendation. There are a number of tools from converting from BAM back to FASTQ, and the Picard tool should work just fine. It does have trouble with paired-end mappings in certain circumstances though, and if you run into trouble using Picard I'd suggest <a rel=""nofollow"" href=""http://bedtools.readthedocs.org/en/latest/content/tools/bamtofastq.html"">bedtools bamtofastq</a>.</li>/ol>s>Is the idea here that you're going to map to a bunch of plastid reference sequences from various organisms, and then convert the aggregate mappings back to FASTQ and perform an assembly from them? If so, I say concatenate the reference sequences into one file and map against that. That way it will be easier to retain the best mappings up front, especially if you don't care about <em>which</em> reference you're mapping to.</s>",3,"analysis, tool",analysis_and_tool
79727,2013-08-23,"Interpreting ""*"" In Extended Cigar Format","I generated and alignment using <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> and the .sam file looks fine, except in my parser I'm not sure how to interpret the extended CIGAR format when the CIGAR string is simply ""*"".  Looking at the <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">samtools</a> documentation:a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAMv1.pdf"">http://samtools.sourceforge.net/SAMv1.pdf</a>It just says to the CIGAR is set to ""* if unavailable"", but don't really know what ""unavailable"" means.  Should I assume the read did not align at all? What would cause <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> to produce a CIGAR of *?",1,8713,"samtools, alignment, cigar, bwa",The <code>*</code> means no alignment to show.,3,"analysis, tool",analysis_and_tool
71195,2013-05-09,Sequence Alignment Using Snap Tool,"can anyone tell me about performance of SNAP sequence aligner tool, and its comparision with other existing tools like novoalignmpi, <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/"">BWA</a> and Bowtie, in terms of speed on multi-core  system and accuracy. Actually i have tested SNAP on 48-core machine, and it does alignment in 22 minutes , with read file size 1.8GB &amp; 1.8 GB. I want a confirmation that is it faster than novoalignMPI. I am from computer science background, so i dont have much idea about others tool.thank you.",1,7845,"sequence, alignment, bwa","try <a rel=""nofollow"" href=""http://gel.ahabs.wisc.edu/mauve/download.php"">MAUVE</a>",3,"analysis, tool",analysis_and_tool
61421,2013-01-21,Differences In Alignments When Run Twice (Using The Same Reads/Reference As Input),"Hi,I wonder if it is possible to get <strong>different resulting alignments</strong> using the <strong>same</strong> reads and the same reference as <strong>input</strong>?I did the alignment step twice and my BAM-files from the two runs differ slightly. I used BWA for the alignment step. Is there any possibility that BWA's decisions where to align a read can differ within two runs having exactly the same parameters and input? Are there any <strong>""random"" steps in the algorithm?</strong> strong>Does multi-threading affect the alignment?</strong> Furthermore I found, that the regions differing in between the two BAMs showed <strong>strikingly low read-quality</strong>. But I don't know if this has something to do with the observed problem.Any help or further insight is appreciated.Cheers,Stroehli",2,5845,"bam, bwa, alignment","Yes, some C random functions are used by bwa:$ grep rand bwa-0.6.2/*.c | grep -v strand pre><code>bntseq.c:            if (c &gt;= 4) c = lrand48()&amp;3;bntseq.c:    bns-&gt;seed = 11; // fixed seed for random generatorbntseq.c:    srand48(bns-&gt;seed);bwa.c:    // count number of hits; randomly select one alignmentbwa.c:        if (drand48() * (p-&gt;l - p-&gt;k + 1 + cnt) &gt; (double)cnt) {bwa.c:            one-&gt;sa = p-&gt;k + (bwtint_t)((p-&gt;l - p-&gt;k + 1) * drand48());bwape.c:    srand48(bns-&gt;seed);bwase.c:            if (drand48() * (p-&gt;l - p-&gt;k + 1 + cnt) &gt; (double)cnt) {bwase.c:                s-&gt;sa = p-&gt;k + (bwtint_t)((p-&gt;l - p-&gt;k + 1) * drand48());bwase.c:         * number of random hits. */bwase.c:                    double p = 1.0, x = drand48();bwase.c:    srand48(bns-&gt;seed);bwtsw2_aux.c:            if (p-&gt;flag&amp;1) q-&gt;qual = 0; // this is a random hitbwtsw2_aux.c:            if (c &gt;= 4) { c = (int)(drand48() * 4); ++k; } // FIXME: ambiguous bases are not properly handledbwtsw2_aux.c:            if (c &gt;= 4) c = (int)(drand48() * 4);bwtsw2_core.c:    { // choose a random onebwtsw2_core.c:        j = (int)(i * drand48());bwtsw2_main.c:    srand48(11);/code></pre>",5,"analysis, tool",analysis_and_tool
51186,2012-08-16,How To Compare The Performance Of Bwa And Bowtie,"I am experimenting with <a rel=""nofollow"" href=""http://bowtie-bio.sourceforge.net/manual.shtml"">BowTie</a> vs <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/bwa.shtml"">BWA</a>. Now, I have to do experiments for various length reads. So, I am trying to find 180, 200, 240 bp read length databases. Can anybody help me where and how I can get those databases. I have tried to find <a rel=""nofollow"" href=""http://www.ncbi.nlm.nih.gov/sra?term=human%20200%20bp"">here</a>. However, unable to find. Can anybody help me on this ? Thanks in advance.",1,4641,"alignment, bwa, bowtie, read, genome","You may also want to experiment by generating reads with a <a rel=""nofollow"" href=""http://www.biostars.org/post/show/2194/what-ngs-read-simulators-are-available-for-paired-end-data/"">read simulator</a> from different genomes.  It is a quite eye opening experience to see perfect reads not matching back to the genome.",5,"analysis, tool",analysis_and_tool
45707,2012-05-25,How To Reconstruct A Consensus From A Hmmer Hmm Profile,"Hi,I am trying to (and understand how to) extract the consensus of a protein alignment from its HMM profile (produced by HMMer2). I understand that from the ""match emission line"" I can get the corresponding amino acid (the one with the higher match emission score) when the most probable transition is 'm-&gt;m'. Am I right in assuming that a ""dot"" has to be inserted in the consensus when the most probable transition is 'm-&gt;d' or 'd-&gt;d'? what happens with 'd-&gt;',  'm-&gt;i', and 'i-&gt;i'?Any help would be appreciated.Cheers,M;",1,3857,"hmm, hmmer, alignment, consensus",Try using the program hmmemit from the HMMER suite.  I think that you need the -c option to get the consensus...The -h will list all options.And yes a . Represents an insert respect to the model and a dash a delete state.BestRob,4,"analysis, tool",analysis_and_tool
45732,2012-05-25,Question About Samtools Flag Number 117,"One of the rows in my alignment data has the samtool flag of 117.I used a rel=""nofollow"" href=""http://picard.sourceforge.net/explain-flags.html"">http://picard.sourceforge.net/explain-flags.html</a>to figure out what it means. The following is the summary for flag 117:ol>li>read paired</li>li>read unmapped</li>li>read reverse strand</li>li>mate reverse strand</li>li>first in pair</li>/ol>My question is, how could a read be ""unmapped"" and be ""reverse strand(aligned to reference)"" at the same time?My guess is samtools define ""unmapped"" as anything that is not ""properly mapped""(meaning both reads in a pair mapped correctly)?Thanks",1,4229,"samtools, alignment","You can find an answer by Istvan <a rel=""nofollow"" href=""http://www.biostars.org/post/show/14239/unmapped-reads-and-sequence-name/"">here</a>.blockquote>  117: read paired, read unmapped, read on reverse strand, mate on reverse strand, first in pair    So the output is correct, what it probably means is that the read and its mate are both on the reverse strand therefore the mapping of this read (and its mate) are questionable, thus it got the unmapped designation./blockquote>",3,"analysis, tool",analysis_and_tool
13780,2011-11-02,Bwa Error While Trimming Color Space Data,"I am using the following pipeline for aligning some paired end SOLiD data. pre><code>bwa aln -c -n 0.06 -o 2 -t 8 -q 10 ~/genomes/hydra/ACZUJGI/color/hydra ~/hydra/solid/hsamp_F3.fastq.gz &gt; /scratch/hydra/hsamp_F3.saibwa aln -c -n 0.06 -o 2 -t 8 -q 10 ~/genomes/hydra/ACZUJGI/color/hydra ~/hydra/solid/hsamp_R3.fastq.gz &gt; /scratch/hydra/hsamp_R3.saibwa sampe -P ~/genomes/hydra/ACZUJGI/color/hydra /scratch/hydra/hsamp_F3.sai /scratch/hydra/hsamp_R3.sai ~/hydra/solid/hsamp_F3.fastq.gz ~/hydra/solid/hsamp_R3.fastq.gz | samtools view -bS -|samtools sort - /scratch/hydra/hsamp_solid/code></pre>On running this I get the following error. Just showing the last few lines from the output here. I only get this error when the <code>-q</code> parameter is nonzero. pre><code>[bwa_paired_sw] 91 out of 33101 Q17 discordant pairs are fixed.[bwa_sai2sam_pe_core] time elapses: 74.36 sec[bwa_sai2sam_pe_core] refine gapped alignments... 1.53 sec[bwa_sai2sam_pe_core] print alignments... [samopen] SAM header is present: 20914 sequences.Parse error at line 20916: sequence and quality are inconsistent/code></pre>The error happens at the conversion to bam step in the pipeline. If I look at line 20916, it showspre><code>1_29_54 141     *       0       0       *       *       0       0       NNCANGNAANANATCNNCCGGNTANANTTGANTTANNTTN        !!@;!9!:?!;!:&gt;&gt;!!8?57!66!7!8=&lt;9!&lt;&lt;9!!-?!!!&amp;!&lt;!!!!!      XC:i:40/code></pre>Thus the read is truncated but the quality line is not. Is there a workaround for this?",2,512,"bwa, alignment","I think the proper answer is don't use -q with colorspace as it's designed for base-space.If you disregard that, you can pipe the output to this command (then to SAM)pre><code>$BWA_COMMAND \| awk 'BEGIN{FS=OFS=""\t""} \      ($1 ~ /^@/){ print $0} \      ($1 !~ /^@/){ $11 = substr($11, 0, length($10)); print $0}' \| $SAMTOOLS_COMMAND &gt; $OUT/code></pre>That makes sure the qualities are the same length as the sequence.You could also trim your reads with this: <a rel=""nofollow"" href=""https://github.com/brentp/bio-playground/blob/master/solidstuff/solid-trimmer.py"">https://github.com/brentp/bio-playground/blob/master/solidstuff/solid-trimmer.py</a>",3,"analysis, tool",analysis_and_tool
17267,2012-02-10,Do Aligners Tend To Scale With Number Of Bases Or With Number Of Reads?,"I would like to find an efficient way of aligning large fastq files (to the human reference genome) by first splitting-up the fastq into smaller pieces so that they can be aligned in parallel.  I can think of two ways of doing this: splitting the fastq up either into files with a fixed number of bases (e.g. a billion bases per file) or into files with a fixed number of reads (e.g. 10 million reads per file). I was wondering if anyone knows which approach should be more efficient in terms of run time? This question is particularly applicable when different fastq files have different read lengths.I suppose another way of asking the way question is: Do aligners tend to scale with number of bases or with number of reads (in terms of run time)?  The aligners I am most interested in are BWA, BFAST and stampy.Many thanks,Ian",5,3833,"alignment, bwa, fastq","BWA roughly scales with the number of bases. Nonetheless, I do not think it matters at all with data splitting. The total CPU time is roughly fixed. The wall-clock time depends on how many CPU cores you use at once.",7,"data_format, analysis, tool",analysis_and_tool
7958,2011-05-02,Aligning Colorspace Reads Using Bwa,"I have about 100 million reads from a SOLiD run. I am trying to align them using bwa and I got 0 alignments. What am I doing wrong here? Here are the commands that I am usingpre><code>~/software/bwa-0.5.9/bwa aln -n 6 -t 6 -o 2 -c ~/genomes/hsap/hg19.fa sampleTF5.fastq.gz    ~/software/bwa-0.5.9/bwa samse ~/genomes/hsap/hg19.fa sampleTF5.sai sampleTF5.fastq.gz |samtools view -bS -|samtools sort - sampleTF5/code></pre>About 40% of the reads align using Bioscope so I know that at least some reads should align. The index was created using -c so it is a colorspace index.ETA: Couple of reads from the fastq filepre><code>@853_2_23T10201001101112312122022330313023.22201032232203002+.06%8+23,-/,740&amp;+2,&amp;(*+&amp;26%&amp;%'';!%'(&amp;)':2((,,-'%(.@853_2_76T00221112202322220011002232000222000212301132232001+&amp;&lt;*(%'?'&amp;'&amp;5)*'%%%&amp;('-'(()-')&amp;)&amp;%)*'/%%&amp;%'%(%&amp;&amp;'&amp;%/code></pre>",4,512,"bwa, alignment, solid","I found the solution to this and Alastair's link helped. Apparently bwa needs the fastq files to be 'double encoded'. Thus, you have to rewrite the colorspace fastq with tr/0123./ACGTN/ to get bwa to work. I am adding the solution here just in case others run into this issue too.",3,"analysis, tool",analysis_and_tool
13878,2011-11-04,Domain Search Using Hmmer,"I used Hmmer search for finding domains from sequences,though HMMER is extremely fast and very useful,when i compared the results with the databases,HMMER identifies domains that are usually short of 1 or 2 residues,please help me how to overcome this.For example uniprot says domains starts from 'MKAM...' till '...ANDA';HMMER says its from 'AM....AN'.This happens because of the way HMM profile is defined or is it due to some parameter changes? Thanks in advance",3,2691,"domain, retrieval, hmmer","Are you using HMMer 3.0? The author blogged about the heuristic way HMMer 3 determines the sequence alignment:a rel=""nofollow"" href=""http://selab.janelia.org/people/eddys/blog/?p=508"">http://selab.janelia.org/people/eddys/blog/?p=508</a>I've noticed it's common for the HMM alignment to treat the first or last 1-2 residues as inserts rather than matches, and it seems to be because of the kind of fuzzy probabilistic way the domain alignment is modeled. I'm not aware of any parameters you can change to affect the alignment envelope. Maybe this will be better in HMMer 3.1.To make a slight tradeoff in sensitivity for consistency in your alignments, you could use RPS-BLAST instead. Try it out on a web server and download PSSM databases here:a rel=""nofollow"" href=""http://www.ncbi.nlm.nih.gov/Structure/cdd/cdd.shtml"">http://www.ncbi.nlm.nih.gov/Structure/cdd/cdd.shtml</a>(It's also possible that the HMM profiles you used are not the same as Uniprot's.)",3,"analysis, tool",analysis_and_tool
3399,2010-11-08,Best Bwa Parameters For Mirna Alignment,"im analyzing a miRNA run from illumina genome analyzer. i received the data with the adapter already trimmed off, and im now at the point of aligning my reads against a reference. <br>when i try and align the reads using bwa's default params: bwa aln ref.fasta read.fasta &gt; read.saiim getting &lt;10% alignment (~90% of the reads are not getting aligned). when i tried aligning using novoalign (that has the -s parameter to allow trimming) around 50% of the reads were aligned. this leads me to believe there is a parameter set in bwa that is more suitable for short RNA (including miRNA) alignment.thoughts?",3,474,"mirna, bwa, alignment","Some details worth considering:How long are your reads? How long are the miRNAs you are looking for?I have also seen on my data that bwa reported fewer alignments than some other aligners (even blat and lastz) given the standard parameters.There are some parameters worth a check:pre class=""pre""><code class=""language-bash"">-n NUM    max #diff (int) or missing prob under 0.02 err rate (float) [0.04]/code></pre>Try increasing <code>-n</code>pre class=""pre""><code class=""language-bash"">-o INT    maximum number or fraction of gap opens [1]/code></pre>Try increasing to 2 or 3pre class=""pre""><code class=""language-bash"">-l INT    seed length [32]/code></pre>the default 32 seems a little large to me especially if your query is short, try reducing towards 8 if that is possibleI would also try bowtie, bfast and maybe some others. For all the seed length parameter is important to increase sensitivity.",5,"analysis, tool",analysis_and_tool
18174,2012-03-05,Bwa Bwasw: How To Print Only The Reads Aligned With The Reference Sequence,"Hi,BWA usually reports one  line for each read even when the read don't mapped the reference sequence.There are some way to print in the sam file only the alignment when the read are aligned with the reference sequence?Thanks in advanceCris  ",2,3905,"bwa, alignment","samtools view -F 4 your.bamThis is directly from the manual of Samtools.  I recommend reading all the options.  It tried to avoid it, but really knowing Samtools is worth the time!",6,"analysis, tool",analysis_and_tool
53546,2012-09-25,"Simple Question: What Is ""Large"" For Bwa?","I'm using bwa to align reads, and I have to choose the indexing method to use.  The documentation says to use <code>-a is</code> for small genomes, and <code>-a bwtsw</code> for large genomes.  I've used <code>is</code>, but sometimes this will crash with a segmentation fault, and <code>bwtsw</code> seems to work.  Surely there is a better way to decide this than by trial and error?  At what size is a genome ""large"", meaning I should use <code>bwtsw</code>?  What is really the difference here?",3,1323,"bwa, alignment","From <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/bwa.shtml"">BWA</a> manualpre><code> IS     is moderately fast, but does not work with database larger than 2GB./code></pre>blockquote>  bwtsw Algorithm implemented in BWT-SW. This method works with the whole human genome, but it does not work with database smaller than 10MB and it is usually slower than IS./blockquote>",8,"analysis, tool",analysis_and_tool
59970,2012-12-31,Ibwa Optimization,"iBWA looks Awesome!A few questions:ol>li>Are there any scripts or tool recommendations for creating custom reference/remap files?  Specifically, something that takes a VCF as input?</li>li>What strategy do you recommend for using custom references based on sample genotypes?  Would the primary be hs37lite.fa and the the alternate be all the additional observed alleles similar to the dbsnp137 provided reference?  Or should I be doing something more complicated i.e. phasing to get the two alternate haplotype references.</li>li>Roughly, what's your variant calling pipeline when using iBWA?  Do you think I can drop GATK and the indel realignment step and just use <a rel=""nofollow"" href=""http://samtools.sourceforge.net/"">samtools</a>? </li>li>Are there any recommended methods/caveats to improve iBWA alignment accuracy (i.e. fastq trim/filter), speed (i.e. pBWA) or <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">bam</a> size (gobiBWA). </li>/ol>Best,Daryl",1,6687,"bwa, alignment, vcf, bam","(1) <strong>Reference/remap files</strong>We use joinx to create these: <a rel=""nofollow"" href=""http://gmt.genome.wustl.edu/joinx/current/."">http://gmt.genome.wustl.edu/joinx/current/.</a> The usage is as follows:pre><code>joinx create-contigs -v my_variants.vcf -r my_refseq.fa -o my_new_contigs.fa -R my_new_contigs.fa.remap --flank=99/code></pre>This creates a new reference/remap pair with one sequence per variant* in my<em>variants.vcf (variants are relative to my</em>refseq.fa) with 99bp flanking on either side of the variant.*The command is currently set up to only create sequences for variants that have an identifier (e.g., rsid). This was fine for making the dbsnp reference but is probably not ideal for general use cases. I will make the identifier requirement optional and maybe add a few more options (like skipping sites that fail filters and some things described in the next point) shortly.(2) <strong>Refs based on sample genotypes</strong>What you said (hs37lite.fa as the primary, output of joinx create-contigs as the alternate) is how we do it. Right now, joinx doesn't look at the genotype data; contigs are created for every alternate allele in the ALT field for each site in the vcf file (whether or not the variants appear in a GT call). I will add some options to do things like only process alleles that are present in GT calls, and maybe allow some basic filtering based on INFO/FORMAT fields (e.g., DP &gt; 20). In any case, I don't think you need to worry about phasing in the vcf sample data (GT=1/2 vs GT=1|2); you will get both sequences created either way.(3) <strong>Variant calling pipeline</strong>I wouldn't change what you're doing right away. I would suggest running things through your existing pipeline to see how the results vary. Most of the testing I have done personally has just used samtools for variant calling after aligning with ibwa (not necessarily because I feel like that is the best thing to do). If you are wanting to generate sequences from existing sample data in a vcf, then I would definitely not suggest simplifying your existing calling strategy for generating the initial set of variants as you will want your alternate hypotheses to be as accurate as possible.(4) <strong>Optimizations</strong>Any pre-processing that works for bwa (trimming, filtering) should work the same for ibwa. The only differences between ibwa and stock bwa 0.5.9 are in sampe, so any methods that speed up ""bwa aln"" that yield equivalent .sai files are applicable (pbwa might be an option here). GobyBWA looks like it has its own file formats, so that will not work well. Lastly, ibwa sampe does have a -t option to support multi-threading. There have been some other sampe threading patches to bwa that work a bit better (at the expense of using more memory) than what I did in ibwa, but the -t option is worth trying if you become angry about the wall clock time used by ibwa sampe.",3,"data_format, analysis, tool",analysis_and_tool
13299,2011-10-20,Samtools Tview Legend,"Hi.I would like to understand the output screen produced by a ""samtools tview"". I may not googling with good keywords, but I just can't find any document explaining the meaining of ""."", "","" underlined characters, etc. Thanks in advance.",2,2908,"samtools, alignment, visualization, viewer","I disagree with @Pierre.code>,</code> : negative strand,code>.</code> : positive strand.You could try to separate the reads by its strand using the bitwise flag.code>samtools -f 0x10 -b aln.bam&gt; aln.neg.bam</code> would give you all the reads mapped to negative strand,code>samtools -F 0x10 -b aln.bam&gt;aln.pos.bam</code> would give the positive reads.Then you could use <code>samtools tview</code> to see them. Due to alternative splicing, the RNA-seq reads would normally have <code>123N</code>, for example, in their cigar string, which means skipped reads, a.k.a splicing junction spanning reads.You would see the following for positive strand:pre class=""pre""><code class=""language-bash"">CATCACTGGTTTAAAGACAAACTTGCATTGTGAGATTCCAAAATAACAACAACAAAAAACAATTTGCATTGAGAACATTTTGAAG.........A............&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;.....&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;/code></pre>You would see for negative strand.pre class=""pre""><code class=""language-bash"">TTTCATTTGCAAGTAATCGATTTAGGTTTTTGATTTTAGGGTTTTTTTTTGTTTTGAACAGTCCAGTCAAAGTACAAATCGAGAG...KK....KKK..KK.K.K...K........K....K..................KKKK.........K...K...........&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;,,,,,,,,t,,,c,,,,,,,,,,/code></pre>",4,"analysis, tool",analysis_and_tool
151074,2015-07-16,How to remove a chr from a bam file?,"Hi.If you want to remove reads mapped on a certain chr, how would you do that?I know 'samtools' can extract reads on a chr. Extraction of each chr and combining chr data I want would solve the problem, but I have multiple bam files to run it.So, if anyone of you know how to REMOVE a single chr (e.g. chr1 only), please tell me.Thank you!",1,5024,"RNA-Seq, samtools","See this post: ""https://www.biostars.org/p/128967/"" rel=""nofollow"">Remove mitochondrial reads from BAM files</a>",6,"analysis, tool",analysis_and_tool
167892,2015-11-30,BWA mem how to know if a read is mapped uniquely?,"I have read many posts regarding this question. The XT, XA tag doesn't seem to be used anymore by BWA mem, so I can't use them to identify uniquely mapped reads.Some posts said that multiple hits are to be assigned a quality score of 0. However, I don't have any links to confirm if this is still true. Does anyone know where I can confirm this?Does anyone know how to tell if a read is uniquely map from the result of BWA-mem alignment? Thank you.",1,22089,"bwa, alignment","You can filter out the secondary alignments in your file by excluding reads with the ""secondary"" flag (0x100 binary or 256 decimal) set. You can use samtools for this:pre>samtools view -F 256 file.bam</pre>",3,"analysis, tool",analysis_and_tool
11005,2011-08-08,Burrow-Wheeler Alignment,"Can anyone, in a simple, explicit way, point out the trick which improve aligning speed/efficiency by burrow-wheeler transform (BWA/Bowtie compared to MAQ)?I read the paper about MAQ,BWA,Bowtie, and also review, but only become more confused. What's the trick here?thx",12,2045,"bwa, alignment, bowtie","Let's consider exact matching and inexact matching separately.For the exact matching problem, it is true that BWT-based algorithms are faster. Suppose we have a read of length ""l"" (letter ell, not one) and a genome of length ""L"". If we use a naive k-mer hash table, each k-mer appears L/4^k times. Thus the time complexity is O(l*L/4^k). For human, L=3e9 and typically k=13. L/4^k is about ~50, which is not a small number already. In practice, a hash-table based method does even worse because the human genome is much more repetitive than a random string. A lot of k-mer have thousands of occurrences. Visiting each of them is quite slow. In contrast, with BWT (more exactly FM-Index), we can always tell if the read has a perfect match in O(l) time, no matter how long or how repetitive the genome is. Essentially, FM-index collapses all the copies of a substring. We simultaneously align a sequence to all copies, rather than align to each copy like what we do with a hash table. This is why BWT-based algorithms are faster.On the other hand, I do not think BWT-based algorithms are faster for inexact matching problem. For inexact matching, we may still need to visit multiple copies similar to the read sequence. Although with BWT we still do better than with a hash table in theory, as each BWT operation is more expensive, the advantage of BWT is reduced. Moreover, for longer short reads, we can start to use multiple seeds, which may greatly boost the performance of hash table based algorithms. In fact, for 100bp reads, several hash table based mappers compete BWT-based ones on speed.Most of us get the impression that BWT-based algorithms are faster because for 30bp reads they were by far faster than the first-generation hash-based short-read mappers such as SOAP1 and MAQ. This is not necessarily true nowadays. In addition, we may misbelieve BWT-based ones are faster because they are popular, but this may be more related to the fact they are relatively well developed (e.g. user friendliness, memory and even reputation), instead of speed. Another fact we frequently overlook is that the most accurate short-read mappers are still based on hash tables. For BWT-based methods, differentiating subtle hits dramatically increases the computing time. It is very difficult to get an extreme accuracy while maintaining a reasonable speed.",29,"analysis, tool",analysis_and_tool
143491,2015-05-21,How to remove reads associated with a specific region from bam file?,"Dear Members,Is there a way I can removes reads associated with a region (chr, start, end) from a .bam file (RNASeq data) prior to the application of HTSeq?I will greatly appreciate your feedbackNoushin",4,15871,"alignment, RNA-Seq, samtools","<pre class=""pre""><code class=""language-bash"">bedtools intersect -abam file.bam -b filter.bed -v &gt; filtered.bam/code></pre>filter.bed should containpre class=""pre""><code class=""language-bash"">chr    start     end/code></pre>",9,"analysis, tool",analysis_and_tool
238628,2017-02-23,BWA mem output inconsistent on same but re-ordered FASTQ input,"Hello, I've noticed that bwa mem outputs results to be inconsistent under following setting.  I'd have expected this to be not the case, and would appreciate if someone can comment on why this is happening. I have tested this with both bwa mem v0.7.5 and 0.7.15.Steps to reproduce:1. Create multiple FASTQ paired-end files from a reference FASTQ set of files. So, if there are 10000 read in our reference FASTQ files (s1.fastq, and s2.fastq), I generate another set of fastq files which also have the same 10000 reads but in a different order. I used the following script to do so.pre><code class=""lang-py"">#!/usr/bin/env pythonimport Bioimport Bio.SeqIOimport sysimport randomfile1 = sys.argv[1]file2 = sys.argv[2]record1 = []record2 = []for s in Bio.SeqIO.parse(file1,""fastq""):    record1.append(s)for s in Bio.SeqIO.parse(file2,""fastq""):    record2.append(s)# Lets make sure both files have same number recordsassert(len(record1) == len(record2))rand_idx = random.sample(xrange(len(record1)), len(record1))r1 = open(""reorder1.fastq"", ""w"")r2 = open(""reorder2.fastq"", ""w"")for idx in rand_idx:    Bio.SeqIO.write(record1[idx], r1, ""fastq"")    Bio.SeqIO.write(record2[idx], r2, ""fastq"")r1.close()r2.close()print(""Wrote %d records"" % len(record1))/code></pre>This will say output the following files:pre><code>$ lsreorder1.fastq  reorder2.fastq  s1.fastq  s2.fastq  shuffle_fastq.py/code></pre>The original files were s1.fastq, s2.fastq.  The newly generated shuffled files are reorder1.fastq, reorder2.fastq.  I made sure reorder1.fastq has all the entries in s1.fastq (and the same for reorder2.fastq/s2.fastq) using this:pre><code class=""lang-py"">#!/usr/bin/env pythonimport Bioimport Bio.SeqIOimport sysfile1 = sys.argv[1]file2 = sys.argv[2]results = []records = {}for s in Bio.SeqIO.parse(file1,""fastq""):    records[s.id] = sfor s in Bio.SeqIO.parse(file2,""fastq""):    if not records[s.id].seq == s.seq:        results.append(s)print ""Unmatched records"", len(results)/code></pre>2. Run BWA mem on the output FASTQ file pairs r1.fastq/r2.fastq and s1.fastq / s2.fastqpre><code>$ bwa mem -R ""@RG\tID:foo\tLB:bar\tPL:illumina\tPU:illumina\tSM:ERR000589"" /share/BWA_Index/hg19.all_chr.fa s1.fastq s2.fastq &gt; s.sam$ bwa mem -R ""@RG\tID:foo\tLB:bar\tPL:illumina\tPU:illumina\tSM:ERR000589"" /share/BWA_Index/hg19.all_chr.fa reorder1.fastq reorder2.fastq &gt; reorder.sam # Sort sam files so we can compare them with diff $ cat reorder.sam | samtools view -Sb - | samtools sort - reorder_sort &amp;&amp; samtools view reorder_sort.bam &gt; reorder_sort.sam  $ cat s.sam | samtools view -Sb - | samtools sort - s_sort &amp;&amp; samtools view s_sort.bam &gt; s_sort.sam/code></pre>3. Compare the output sam files s.sam and r.sam, and I see different alignments!!pre><code>diff reorder_sort.sam s_sort.sam/code></pre>Is anyone aware of why this could happen? I've tried this experiment several times with the following results:pre><code>Total# FASTQ Reads....   Inconsistent Alignments2500                     13512500                    660125000                   6830/code></pre>",1,37345,"Assembly, alignment, bwa-mem, bwa","There are two sources of randomness. The first is caused by the insert size estimate. Different batches of reads have slightly different insert size distribution, which affects paired-end alignment. You can in principle feed the insert size distribution to bwa-mem, but the bwa-mem estimate is usually better than a naive estimate and is at least more convenient.The second source is the ""random"" placement of repetitive hits. Bwa-mem is not really using a random number generator. It instead hashes deterministic information, such that the i-th read in the input is always associated with the same hash and has the same mapping. Reordering obviously breaks the deterministic behavior. I later learned that Bowtie2 hashes read names instead of the index of read. That is usually a better strategy except when you change read names.",9,"analysis, tool",analysis_and_tool
257722,2017-06-13,Samtools sorting by read names vs. chromosomal coordinates,Samtools has the options of sorting alignments by read name or by chromosomal coordinate. Why would someone choose one over the other? What are some practical aspects to consider for each sorting method for downstream applications (e.g. counting the number of hits vs. the reference genome).,2,21210,"samtools, sort, alignment","Many programs require bam files to be sorted by coordinates; this can save memory when doing specific operations like variant-calling and coverage calculation.  Also, programs like IGV need sorted, indexed bam files so that when you display a certain genomic area, they can rapidly access and display the relevant reads.Name-sorting is useful when doing operations that require reads to be paired.  Sam files often break interleaved pairing order, and coordinate-sorted bam files always do.  With a coordinate-sorted bam, it can take a lot of time and memory to restore the original fastq read order (the original fastq cannot typically be fully restored).  Name-sorting the file makes restoring pairing trivial, since the original reads are adjacent.So - some downstream programs require a sorted, indexed bam.  For those programs, that's what you need to provide.  But when programs are capable of handling unsorted sam output, I suggest using a gzipped sam file with reads in the original order, which makes recovery or remapping of the original data much easier (aside from the inherent lossiness of the sam format, which will discard the original names), and generally makes pipelines faster compared to using bam files as an intermediate stage.Note that as of samtools 1.4, the bam format is much faster and may be competitive with gzipped sam files, depending on the situation.",8,"analysis, tool",analysis_and_tool
270090,2017-08-30,Meaning of BWA-MEM MAPQ values,"Does anyone know what the <code>MAPQ</code> values produced by <a rel=""nofollow"" href=""http://bio-bwa.sourceforge.net/""><code>BWA-MEM</code></a> mean? I'm looking for something similar to what <a rel=""nofollow"" href=""http://www.acgt.me/blog/2015/3/17/more-madness-with-mapq-scores-aka-why-bioinformaticians-hate-poor-and-incomplete-software-documentation%20"">Keith Bradnam discovered for TopHat v1.4.1</a>, where he realized that:blockquote>  0 = maps to 5 or more locations     1 = maps to 3-4 locations     3 = maps to  2 locations     255 = unique mapping/blockquote>I'm familiar with the notion that MAPQ should be theoretically be related to the probability of an ""incorrect"" alignment (10^(-<code>MAPQ</code>/10)), although this is vaguely-specified enough that aligners in practice tend to actually just use something like the above. Note that this is different than the <code>BWA</code> <code>MAPQ</code> scoring interpretation, because <code>BWA-MEM</code> gives <code>MAPQ</code> scores in the range [0,60], rather than [0,37] as has <a rel=""nofollow"" href=""http://www.acgt.me/blog/2014/12/16/understanding-mapq-scores-in-sam-files-does-37-42"">been established for <code>BWA</code></a>.",6,41198,"alignment, DNA-seq, bwa","MAPQ scores are not meaningful because BAM is not meaningful - or rather, the field has yet to define the difference between read-alignments (what BAM officially stores) and fragment-alignments (what most aligners produce).The issue goes far deeper than MAPQ scores, but if you want to read about MAPQ this is a good resource:a rel=""nofollow"" href=""https://sequencing.qcfail.com/articles/mapq-values-are-really-useful-but-their-implementation-is-a-mess/"">https://sequencing.qcfail.com/articles/mapq-values-are-really-useful-but-their-implementation-is-a-mess/</a>But attempting to create a common standard is impossible. People want different things out of the MAPQ score, and so there can not be a single standard. Some people want it to represent how well the alignment aligns, others how well the fragment in it's entirety aligns, others a combination of both, sometimes with and sometimes without taking into account how many other possible alignments there might be for the read/fragment. It's a mess, and it all stems from the fact that pretty much every aligner produces non-standard BAMs except BWA, which produces BAMs no one would use if they needed to store more than one alignment per sequencing event.",3,"analysis, tool",analysis_and_tool
14573,2011-11-22,Two Fastq Files And Alignment With Bwa.,"I have two fastq files.  I want to use bwa to produce two sam files as this is more efficent for me than merging the fastq files and running bwa on the bigger file.  If I run bwa separately on the fastq files and merge the sam files later, will the result be different?  (I don't know if this is an important detail, but I know a priori that the fastq files have reads from separate chromosomes.)",1,4586,"bwa, sam, alignment, fastq","Individual reads are mapped independently of each other. So mapping the reads in two chunks should produce the same mappings as a single file. However, I wouldn't expect mapping runs to always be identical as there is a random element to mapping repetitive hits.",9,"data_format, analysis, tool",analysis_and_tool
304727,2018-03-20,Calculating amount of reads on certain chromosomes in bam file,"Hi,I'm looking for a nice way to calculate the percentage of reads on specifique chromosomes (MT und (1-23,X,Y) und unplaced scaffold).I know I can get the read counts per chromosome with <code>samtools idxstats</code>, however I have a lot of bam files and I would like to automate the calculation. The problem is, I'm struggling with basic batch text maniplulation and would therefore appreciate any help you can give me (specific or general).Edit: I forgot to mention, that I have multiple bam files, which are indexed and only consist of uniquely mapped reads.",1,41976,"RNA-Seq, bam, samtools","I'd suggest to also having a look at <a rel=""nofollow"" href=""https://github.com/brentp/mosdepth"">mosdepth</a> and <a rel=""nofollow"" href=""https://github.com/brentp/goleft/tree/master/indexcov"">indexcov</a>.",3,"analysis, tool",analysis_and_tool
280837,2017-10-31,bwa mem: Passing a variable to read group,"I would like to add read group info (<code>-R</code>) during the mapping/alignment stage as part of my variant calling gatk pipeline.I am doing something like this:pre class=""pre""><code class=""language-bash"">bwa mem \-M \-t 8 \-v 3 \-R &lt;(sh a-illumina-read-group.sh $1) \""$path_dr_bwaindex_genome"" \$1 $2/code></pre>where the read group string is generated automatically from the fastq file by the shell script <code>a-illumina-read-group.sh</code>. It produces a string like: code>'@RG\tID:ST-E00215_230_HJ3FMALXX_2\tSM:ST-E00215_230_HJ3FMALXX_2_ATCACG\tLB:ATCACG\tPL:ILLUMINA'</code>but, when I run bwa, it fails with this error:code>[E::bwa_set_rg] the read group line is not started with @RG</code>I have tried excluding the single quotes (<code>''</code>) around read group info, but that didn't change anything. I also tried variations in how the variable is passed.code>-R=$(sh a-illumina-read-group.sh $1) \</code>code>-R=$(echo $(sh a-illumina-read-group.sh $1)) \</code>Just as a test, I tried:code>rg='@RG\tID:ST-E00215_230_HJ3FMALXX_2\tSM:ST-E00215_230_HJ3FMALXX_2_ATCACG\tLB:ATCACG\tPL:ILLUMINA'</code>code>-R &lt;(echo $rg)  \</code>But, they all produce the same error. I would appreciate any solutions to this issue.I understand that I can add read groups later on using PicardTools <code>AddOrReplaceReadGroup</code>, but I thought it might be convenient doing it here in one step.Thanks.",7,16081,"bwa, bwa-mem, alignment, variant calling, gatk","What worked for me was to read the read group information from the fastq file during the mapping run. My read name in the fastq file looks like this: <code>@ST-E00274:188:H3JWNCCXY:4:1101:5142:1221 1:N:0:NTTGTA</code>.The bash file looks like this:pre class=""pre""><code class=""language-bash"">#!/bin/bashheader=$(zcat $1 | head -n 1)id=$(echo $header | head -n 1 | cut -f 1-4 -d"":"" | sed 's/@//' | sed 's/:/_/g')sm=$(echo $header | head -n 1 | grep -Eo ""[ATGCN]+$"")echo ""Read Group @RG\tID:$id\tSM:$id""_""$sm\tLB:$id""_""$sm\tPL:ILLUMINA""bwa mem \-M \-t 8 \-v 3 \-R $(echo ""@RG\tID:$id\tSM:$id""_""$sm\tLB:$id""_""$sm\tPL:ILLUMINA"") \""$path_bwaindex_genome"" \$1 $2 | samblaster -M | samtools fixmate - - | samtools sort -O bam -o ""mapped-bwa.bam""/code></pre>And the bash file is run aspre class=""pre""><code class=""language-bash"">bwa-mapper.sh read_1.fq.gz read_2.fq.gz/code></pre>You can remove this part (<code>| samblaster -M | samtools fixmate - - | samtools sort -O bam -o</code>) and replace with <code>&gt;</code> if you don't need it. <code>samblaster</code> marks duplicates like Picard. I don't remember what <code>fixmate</code> does. The sort part sorts the SAM file and generates an output BAM.",7,"analysis, tool",analysis_and_tool
260542,2017-07-02,bwa mem misaligns my contigs to the reference by a few bases,"Dear all,I have indexed the C. elegans reference genome with:pre class=""pre""><code class=""language-bash"">bwa index output/genome/ref/seq/celegans.fa/code></pre>and then aligned my de novo assembly to the reference with:pre class=""pre""><code class=""language-bash"">bwa mem -t 8 -x intractg output/genome/ref/seq/celegans.fa input/assembly/celegans/hgap/bristol/assembly.fa &gt; output/alignment/pacbio/bwa/ref/bristolAssembly.sam/code></pre>I then pre class=""pre""><code class=""language-bash"">samtools view -bS output/alignment/pacbio/bwa/ref/bristolAssembly.sam &gt; output/alignment/pacbio/bwa/ref/bristolAssembly.bamsamtools sort output/alignment/pacbio/bwa/ref/bristolAssembly.bam -o output/alignment/pacbio/bwa/ref/bristolAssemblySorted.bamsamtools index output/alignment/pacbio/bwa/ref/bristolAssemblySorted.bam/code></pre>to visualise the alignment in IGV.This is what I get: <a rel=""nofollow"" href=""http://cristian-riccio.ch/wp-content/uploads/2017/07/igv_snapshot.png"">http://cristian-riccio.ch/wp-content/uploads/2017/07/igv_snapshot.png</a>You can see that my assembly is the same as the reference, just shifted by 12 bases or so. Has anyone any suggestions about how to solve this problem?Thanks.Best,C.",1,30093,"bwa, bwt, bwa mem, contig, alignment","Solved finally!a rel=""nofollow"" href=""http://cristian-riccio.ch/wp-content/uploads/2017/07/igv_snapshotSolution.png"">http://cristian-riccio.ch/wp-content/uploads/2017/07/igv_snapshotSolution.png</a>I used this command instead, penalising gap extensions less.pre class=""pre""><code class=""language-bash"">bwa mem -t 8 -E0.5 -x intractg output/genome/ref/seq/celegans.fa input/assembly/celegans/hgap/bristol/assembly.fa &gt; output/alignment/pacbio/bwa/ref/bristolAssembly.sam/code></pre>The assembly comes from pacbio, and this technology is 12% indel error in the raw reads, that might be why the contigs also need a bit more lee-ways on indels for alignment.I figured it out with a colleague because we looked at the start of the chromosomes and it started off aligned and got misaligned when there was a larger indel in my assembly.Thanks to all for the suggestions.Best,C.",3,"analysis, tool",analysis_and_tool
327430,2018-07-17,Merge .bam files by groups of lanes,"Hi guys, I have a folder with around 300 <code>.bam</code> files. Each <code>.bam</code> file is a lane of a sample and hence 4 lanes make a sample. I would like to merge the .bam files of the four lanes in a single one by <code>_*S*_</code> where S is followed by a number that represent the number of the sample (e.g. <code>my_experimet_xxx__L001_S1_stimulated_Aligned.bam</code>). Suppose I have 75 samples, i.e. <code>${1...75}</code>. Can anyone help me please? The line I use to merge normally is the following: pre class=""pre""><code class=""language-bash"">samtools merge S1_merged.bam *bam/code></pre>Thank you in advance ",2,5580,"bam, samtools, RNA-Seq","I think this should work for your issue:create a file name samtools_merge.shpre class=""pre""><code class=""language-bash"">$mkdir mergedfor L1 in *_L001_*.bamdo    echo $L1    L2=`echo $L1 | sed 's/_L001_/_L002_/'`    L3=`echo $L1 | sed 's/_L001_/_L003_/'`    L4=`echo $L1 | sed 's/_L001_/_L004_/'`    merged=`echo $L1 | sed 's/_L001_/_merged_/'`    samtools merge ./merged/${merged} ${L1} ${L2} ${L3} ${L4}done/code></pre>This will iterate over each unique sample with L001 somewhere in the name and store other variables by replacing L001 with L002,003,004, and do this for each sample. Then it will run samtools merge on all 4 lanes, then do the same for the next sample until it has gone through all the samples. The filename output will be the same as the sample name, but will substitute lane information with ""merged"". Just run this in your directory with all the bams and you should have merged bams in the dir ""merged"".",7,"analysis, tool",analysis_and_tool
1392,2010-06-09,Bwa Sam Output Doubts,"Can anyone explain the following tags from BWA sam output.pre class=""pre""><code class=""language-bash"">GA004_0001:5:1:1073:12995#0   0       chr10   135119228       37      75M     *       0       0       CTGGGTTTGGCATAGTGGGAGGGCAGGCAGGGGTGGTTTTCCTGGCTACTCAGGGTTGCAGAGGACAGGACCGAA     CCCBCCCBCBCCC=CCCCCCCC@@BCCCCCCBC?C&gt;=CCACAC@A+?;&lt;;BAA@A08A++?6?&lt;9ACCC68=C8&lt;     XT:A:U  NM:i:1  X0:i:1  X1:i:0  XM:i:1  XO:i:0  XG:i:0  MD:Z:45A29/code></pre>How to check whether a tags in unique hot or multiple hits as sam flag is bit confusing to read. Thanks.",3,399,"sam, output, bwa, alignment, format","<a rel=""nofollow"" href=""http://bioinformatics.oxfordjournals.org/cgi/content/short/25/16/2078"">Here</a> and in more details <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">here</a>, you can find a good description of the SAM/BAM standard and what all fields mean. There is also a page with predefined tags and it says how you can make your own.Those starting with X,Y and Z are ""reserved for end user"" Maybe an intermediate program?NM:i:1 Number of nucleotide differencesMD:Z:45A29 String of mismatching positionI don't quite understand when you say ""tags in unique hit or multiple hits""",3,"analysis, tool",analysis_and_tool
266111,2017-08-03,samtools: error while loading shared libraries: libbz2.so.1.0: cannot open shared object file: No such file or directory,"Hi everyone. I keep getting this error message with samtools. I have used samtools in the past plenty of times. I am not sure how to solve it. Any help would be greatly appreciated. samtools: error while loading shared libraries: libbz2.so.1.0: cannot open shared object file: No such file or directoryI have tried googling the error. Nothing specific with respect to samtools has come up. However, there were some fixes that I tried: sudo yum install bzip2-develsudo ln -s <code>find /usr/lib64/ -type f -name ""libbz2.so.1*""</code> /usr/lib64/libbz2.so.1.0However, it asks for a login when I try this fix or others. ",2,40494,"RNA-Seq, samtools","From <a rel=""nofollow"" href=""https://github.com/bioconda/bioconda-recipes/pull/5049#issuecomment-311070184"">https://github.com/bioconda/bioconda-recipes/pull/5049#issuecomment-311070184</a>bioconda now requires conda-forge and the conda-forge version of bzip2 uses shared libraries, while the one in the main channel uses a static library. Since it was compiled against the shared library version you need to also have than included in your environment. Hope this fixes it for you.Try installing samtools with conda-forge included:code>conda install -c conda-forge -c bioconda samtools bzip2</code>",12,"analysis, tool",analysis_and_tool
352354,2018-12-01,Inclusion of ALT contigs and decoys in bwa alignment,"I am using hg38 as a reference for mapping in bwa-0.7.17. I have already created the 5 BWA index files  for my reference fasta file. Since it's advisable to also take into consideration the alternate contigs (hg38DH.fa.alt); I wanted to ask if:1. How do we include the file containing decoy sequences (hg38DH-extra.fa) in the alignment process. ol>li>In case the decoy file is needed, does it need to be in the same folder as the other index files. </li>li>If the bwa index files for the ALT contigs need to be present. </li>/ol>",1,50561,"bwa, NGS, alignment, hg38, bwa.kit","My reference includes the primary chromosomes (1-22, X, Y) plus chrM, all unplaced and random contigs + the EBV decoy. See also <a rel=""nofollow"" href=""https://www.biostars.org/p/342482/"">Which human reference genome should I use?</a>. ALT contigs are typically not included unless you intend to use an ALT-aware alignment pipeline, such as the one in BWAkit. That is typically not necessary unless you are interested in exactly these regions and the variation going on there. Therefore, for standard purposes, do not include them into the reference. The reason is that they represent alternative sequences for regions that are already included in the primary assembly (highly variable regions like MHC) leading to multimapping events between the primary assembly and the ALTs. As most downstream tools typically exclude multimappers, including the ALTs in an ALT-unaware alignment pipeline, eventually leads to a loss of these reads. See also <a rel=""nofollow"" href=""https://gatkforums.broadinstitute.org/gatk/discussion/7857/reference-genome-components"">Reference Genome Components</a>. Once you have all the chromsomes and contigs you want to include as <code>fasta</code>, <code>cat</code> them together into one file and index them with BWA. See again <a rel=""nofollow"" href=""https://www.biostars.org/p/342482/"">Which human reference genome should I use?</a>.",5,"analysis, tool",analysis_and_tool
352965,2018-12-05,How to remove singletons in a BAM file using samtools,"Dear All,I want to remove the singletons from the aligned bam file.Downloaded fastq files using pre class=""pre""><code class=""language-bash"">fastq-dump --split-files SRR1517848/code></pre>Then aligned the paired end fastq files, using BWA by:pre class=""pre""><code class=""language-bash"">bwa mem hg19.fa R_1.fa R_2.fa -o SRR1517848.sam/code></pre>Then converted it to BAM format and <strong>I used samtools to remove the singletons using</strong> : according to the paper, <a rel=""nofollow"" href=""https://peerj.com/articles/600/"">article</a>pre class=""pre""><code class=""language-bash"">samtools view -@ 8 -F 0x04 -b SRR1517848.sam &gt; SRR1517848.bam/code></pre>Then I looked into the stats using samtools flagstat command by;pre class=""pre""><code class=""language-bash"">samtools flagstat SRR1517848.bam/code></pre>which gave;pre class=""pre""><code class=""language-bash"">   Before filtering     4614120 + 0 in total (QC-passed reads + QC-failed reads)    4549753 + 0 mapped (98.61% : N/A)    4609656 + 0 paired in sequencing    2304828 + 0 read1    2304828 + 0 read2    4461356 + 0 properly paired (96.78% : N/A)    4517788 + 0 with itself and mate mapped    27501 + 0 singletons (0.60% : N/A)    39296 + 0 with mate mapped to a different chr    33576 + 0 with mate mapped to a different chr (mapQ&gt;=5)/code></pre>And after filtering pre class=""pre""><code class=""language-bash"">4549753 + 0 in total (QC-passed reads + QC-failed reads)0 + 0 secondary4464 + 0 supplementary0 + 0 duplicates4549753 + 0 mapped (100.00% : N/A)4545289 + 0 paired in sequencing2281318 + 0 read12263971 + 0 read24461356 + 0 properly paired (98.15% : N/A)4517788 + 0 with itself and mate mapped27501 + 0 singletons (0.61% : N/A)39296 + 0 with mate mapped to a different chr33576 + 0 with mate mapped to a different chr (mapQ&gt;=5)/code></pre>strong>So my Questions:</strong>1) So the command to remove the singletons by -F 0x04 have only removed unmapped reads ?2) In both before and after stats the singletons remain, and what are those? Before: <code>27501 + 0 singletons (0.60% : N/A)</code>After : <code>27501 + 0 singletons (0.61% : N/A)</code>3) Is there a way to remove singletons in variant detection GATK pipeline ? what benefits does it have?Thanks",2,30547,"BWA, alignment, samtools, singletons","As per the <a rel=""nofollow"" href=""https://broadinstitute.github.io/picard/explain-flags.html"">SAM flag guide</a> the flag that you are filtering for i.e. <code>0x04</code> is for unmapped reads. This explains the removal of unmapped reads. In case you want to filter for singletons i.e. reads for which the <code>mate is unmapped</code> you an select that as the condition. This gives a SAM flag value of <code>0x08</code>. You can hence change your command to pre class=""pre""><code class=""language-bash"">samtools view -@ 8 -F 0x08 -b SRR1517848.sam &gt; SRR1517848.bam/code></pre>This should remove the singleton reads.",5,"analysis, tool",analysis_and_tool
365882,2019-02-25,remove duplicates with markdup,"Hello all. I am trying to do a paired-end analysis. Ran the 2 fastq files with hisat2:pre class=""pre""><code class=""language-bash"">hisat2 -p 10 -x '..index_hg19/indexed' -1 R1_001.fastq.gz -2 R2_001.fastq.gz -S hisat2output.sam/code></pre>Then : pre class=""pre""><code class=""language-bash"">samtools view -@ 10 -bS hisat2output.sam &gt; hisat2.bamsamtools sort -@ 12 -n hisat2.bam &gt; testSort.bamsamtools fixmate -m -@ 12 testSort.bam testSort_fixmate.bam/code></pre>then i try to remove duplicates : pre class=""pre""><code class=""language-bash"">samtools markdup -r -@ 12 testSort_fixmate.bam &gt; testSort_fixmate-markdup.bam/code></pre>but returns problem : blockquote>  ERROR: queryname sorted, must be sorted by coordinate./blockquote>WHEN i don't use <code>-n</code> option in samtools sort , samtools markdup returns problem:blockquote>  ERROR: Coordinate sorted, require grouped/sorted by queryname./blockquote>I cant find where is the problem. Any help ? ",1,37113,"RNA-Seq, samtools","<strong>edited answer:</strong>You have to <strong>name-sort</strong> for <code>samtools fixmate</code>, and <strong>coordinate-sort</strong> for <code>samtools markdup</code>. Here is the correct order of operations, from samtools man file:pre class=""pre""><code class=""language-bash""># The first sort can be omitted if the file is already name orderedsamtools sort -n -o namesort.bam example.bam# Add ms and MC tags for markdup to use latersamtools fixmate -m namesort.bam fixmate.bam# Markdup needs position ordersamtools sort -o positionsort.bam fixmate.bam# Finally mark duplicatessamtools markdup positionsort.bam markdup.bam/code></pre>strong>original answer</strong>The problem is you are sorting by name (<code>samtools sort -n</code>), and you should sort by coordinate:pre class=""pre""><code class=""language-bash"">samtools sort -@ 12 hisat2.bam &gt; testSort.bam/code></pre>",6,"analysis, tool",analysis_and_tool
370188,2019-03-19,How to align given specific region in genome with manifest file in bwa? ,"Usually when I use alignment with bwa, I follow this script:  code>bwa aln reference.fa sample.fastq.gz &gt; sample.sai</code>But this time I have manifest.txt and I want to target specific regions with this and I want to speed the alignment process with specific output. If It is possible in BWA, I would like to get your answers. Any help is much appreciated. Thanks in advance. ",1,53586,"bwa, manifest, genome, alignment","you need to map everything first, convert this ""manifest.txt"" file as a bed file and extract the regions. <a rel=""nofollow"" href=""https://www.biostars.org/p/49306/"">Samtools And Region List</a>",3,"analysis, tool",analysis_and_tool
407019,2019-11-08,Couting number of similar reads in sam file and output in bed file?,"Hi all,Currently, after mapping, I got a sam file which contained approximately 30 million mapped reads. Then, by using bedtool bamtobed, I was able to obtain a bed file. However, there were so many many similar reads.Therefore, in order to reduce the size of the final bed file, is there any way that I can mention each read only once as well as its number of presentation in the sam file.hr>For instance:hr>var_1     0     15      ATGCATGCATGCCGTAhr>var_1     0     15      ATGCATGCATGCCGTAhr>var_1     0     15      ATGCATGCATGCCGTAhr>var_2     5     20      ATGCATGCGGGCCCChr>Will become:hr>var_1     0     15      ATGCATGCATGCCGTA   3hr>var_2     5     20      ATGCATGCGGGCCCC    1Thank you in advance!",1,58334,"RNA-Seq, samtools, bedtools","Use <code>uniq -c</code> your bed file.pre class=""pre""><code class=""language-bash"">uniq -c mybed.bed &gt; uniqbed.bed/code></pre>orpre class=""pre""><code class=""language-bash"">echo ""var_1 0 38 ATGCATGCATGCCGTAvar_1 0 38 ATGCATGCATGCCGTAvar_1 0 38 ATGCATGCATGCCGTAvar_2 5 40 ATGCATGCGGGCCCC"" | uniq -c3 var_1 0 38 ATGCATGCATGCCGTA1 var_2 5 40 ATGCATGCGGGCCCC/code></pre>",3,"analysis, tool",analysis_and_tool
470719,2020-11-01,Convert 10x single cell RNA-seq bam file to bulk RNA-seq bam file,"Hi, Given a sorted bam file from standard 10x cell ranger output, i.e. from <a rel=""nofollow"" href=""https://support.10xgenomics.com/single-cell-vdj/datasets/4.0.0/sc5p_v1p1_hs_PBMC_1k"">https://support.10xgenomics.com/single-cell-vdj/datasets/4.0.0/sc5p_v1p1_hs_PBMC_1k</a>, I am wondering if it's possible to convert this scRNA-seq bam file to a bulk RNA-seq (""pseudo-bulk"") bam file, e.g. combining reads across all cell barcodes in the bam file?I imagine there is a way to do this using samtools, but could not find any examples.  Any help would be much appreciated.  Thanks!",1,41301,"single cell, samtools, cell ranger, RNA-Seq","It's a normal bam file, just with a few extra tags with cell barcodes and such. You can read more about the tags on the 10X website <a rel=""nofollow"" href=""https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/output/bam"">here</a>. Because there is nothing special about it, you can use any feature counting software designed for RNA-seq, such as Subread or HTSeq.",3,"analysis, tool",analysis_and_tool
304614,2018-03-19,bwa mem and multiply mapped reads ,"I would like to know how BWA mem handles repetitive hits.I know that bwa aln/samse- given a read that maps to multiple regions- will randomly select one region. Each query will be listed once in the sam file, and alternative mapping locations for that read will be listed in XA if the number of hits is less than INT hits.But what about BWA mem? I keep reading that BWA mem differs from bwa aln in that it will split queries, but what about reads that aren't split but still map to multiple locations? Does mem also chose a random location? Are multiply mapped reads reported in the same fashion in bwa mem as they are for bwa aln/samse (that is, with one listing per query and XAs reported if less than INT)? For simplicity's sake, I am not interested in using other aligners. I have pre-trimmed RAD data (80-139bp) from a frog species with a highly repetitive genome.Thank you.",3,45582,"bwa, repetitive genome, alignment","In general, short read aligners take some liberties in the way they report the alignments - as it turns out bwa is no different.Alas in most cases there is surprisingly little information in the docs on the specifics on what gets reported in which way. The following ismy best understanding of how <code>bwa mem</code> chooses to report alignments:ol>li>When a read matches in its entirety, with an equal score in multiple locations, one of the locations is picked at random, is labeled as primary, will be given a mapping quality of zero and will have an XA tag that contains the alternative locations (this is identical to how <code>bwa aln</code> worked)/li>li>When different, non-overlapping regions of a read align with high scores to different, non-linear locations in the genome, the higher score alignment will be labeled as primary, the others may be reported as secondary alignments. There is some threshold on how many of these secondary alignments will be reported (<code>bwa aln</code> did not produce secondary alignments)/li>li>When complementary regions of a read (the pieces add up to the full read) align to different, non-linear genomic locations, with no little to no overlap, one of the alignments will be labeled as primary, the others as supplementary alignments (<code>bwa aln</code> did not produce supplementary alignments)/li>/ol>",13,"analysis, tool",analysis_and_tool
446761,2020-06-30,"pheatmap: Error in hclust(d, method = method) :  NA/NaN/Inf in foreign function call (arg 10)","Hi!I am trying to do an heatmap with pheatmap package but I keep getting this error : blockquote>  Error in hclust(d, method = method) :   NA/NaN/Inf in foreign function  call (arg 10)/blockquote>I have tried with <code>na.omit()</code> and looking at the dataset there is not NA. here my dataset:pre class=""pre""><code class=""language-bash""># A tibble: 5 x 8  `Gene descripti~ `Gene symbol`  mu_p0 `mu_ p2_`  &lt;chr&gt;            &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;1 RIKEN cDNA 0610~ 0610005C13RIK  0.797      1.042 RIKEN cDNA 0610~ 0610007C21RIK 99.9      129.  3 RIKEN cDNA 0610~ 0610007L01RIK 28.4       32.7 4 RIKEN cDNA 0610~ 0610007P08RIK  6.13       2.615 RIKEN cDNA 0610~ 0610007P14RIK 37.9       37.7/code></pre>and here my code:pre class=""pre""><code class=""language-bash"">library(gplots) library(pheatmap)library(RColorBrewer)library(tidyr)mouse &lt;- Mousebaseline %&gt;% drop_na() #remove rows with NA from the merged filedrnames &lt;- mouse$`Gene symbol`#select namemouse &lt;- mouse[-c(1:2)]# remove gene symbolmouse.matrix &lt;-(as.matrix(mouse))rownames(mouse.matrix) &lt;- rnames # assign row namesmouse.matrix &lt;- t(mouse.matrix) #transposemouseUT &lt;- scale(mouse.matrix)pheatmap(mouseUT, scale = ""none"",cluster_rows = T, cluster_cols = T, show_rownames = T, show_colnames = F, clustering_method = ""ward.D2"",border_color= NA, main = ""Mouse baseline (Ward.D2)"")/code></pre>it gives me the same error even if I do not scale prior the heatmap like:pre class=""pre""><code class=""language-bash"">pheatmap(mouse.matrix, scale = ""column"",cluster_rows = T, cluster_cols = T, show_rownames = T, show_colnames = F, clustering_method = ""ward.D2"",border_color= NA, main = ""Mouse baseline (Ward.D2)"")/code></pre>also if I do <code>na.omit()</code> as follow:pre class=""pre""><code class=""language-bash"">library(gplots) library(pheatmap)library(RColorBrewer)library(tidyr)mouse &lt;- Mousebaseline %&gt;% drop_na() #remove rows with NA from the merged filedrnames &lt;- mouse$`Gene symbol`#select namemouse &lt;- mouse[-c(1:2)]# remove gene symbolmouse.matrix &lt;-(as.matrix(mouse))rownames(mouse.matrix) &lt;- rnames # assign row namesmouse.matrix &lt;- t(mouse.matrix) #transposemouseUT &lt;- scale(mouse.matrix)mouseUT&lt;- na.omit(mouseUT)pheatmap(mouseUT, scale = ""none"",cluster_rows = T, cluster_cols = T, show_rownames = T, show_colnames = F, clustering_method = ""ward.D2"",border_color= NA, main = ""Mouse baseline (Ward.D2)"")/code></pre>I got this error: blockquote>  Error in hclust(d, method = method) : must have n &gt;= 2 objects to  cluster/blockquote>thank you for you help!camilla",4,69285,"R, RNA-Seq, pheatmap, arg10",Remove all the rows which have <code>0</code> values across the samplesYou may have all the rows having <code>0</code> values in the dataframe,6,"analysis, tool",analysis_and_tool
48333,2012-07-04,Deciphering Cigar,"Hi, I need to get 5'-end position of each read in <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">SAM</a> file. For reads aligned in forward direction it's provided in <a rel=""nofollow"" href=""http://samtools.sourceforge.net/SAM1.pdf"">SAM</a> file (POS). But for reads aligned onto reverse strand the one has to figure it out from the cigar string. You cannot simple add length of the read to left-most position, as reads may be soft-clipped or some indel may occure. I have written simple python function in order to find right most position of aligned read. Could you have a look and comment on that as I'm not sure if it's correct?pre><code>import re#should nicely separate CIGAR entriescigar_pat = re.compile(r""\d+[MIDNSHP=X]{1}"")def cigar2end( left,cigar ):  """"""Return right-most position of aligned read.""""""  #store info about each CIGAR category  counts={ ""M"":0, #M 0 alignment match (can be a sequence match or mismatch)           ""I"":0, #I 1 insertion to the reference           ""D"":0, #D 2 deletion from the reference           ""N"":0, #N 3 skipped region from the reference           ""S"":0, #S 4 soft clipping (clipped sequences present in SEQ)           ""H"":0, #H 5 hard clipping (clipped sequences NOT present in SEQ)           ""P"":0, #P 6 padding (silent deletion from padded reference)           ""="":0, #= 7 sequence match           ""X"":0, #X 8 sequence mismatch        }  #split cigar entries  for centry in cigar_pat.findall(cigar):    ccount  = int(centry[:-1])    csymbol = centry[-1]    counts[csymbol] = ccount  #get number of aligned 'reference' bases  aligned = counts[""M""] + counts[""D""] + counts[""N""] #+ counts[""=""] + counts[""X""]  right   = left + aligned  return right/code></pre>",9,950,"cigar, sam, samtools, next-gen, alignment","As Sean suggested I use <a rel=""nofollow"" href=""http://code.google.com/p/pysam/"">pysam</a>:pre class=""pre""><code class=""language-bash"">import pysamsamfile = pysam.Samfile( ""somefile.bam"",""rb"" )#process all reads in regionfor sam in samfile.fetch( ref,start,end ):    print sam.pos, sam.aend/code></pre>",5,"analysis, tool",analysis_and_tool
172737,2016-01-14,How to efficiently remove a list of reads from BAM file?,"Hi Guys,I have a BAM file, and a big read list. What I want to do is to remove the reads in the read list from the BAM file. I can transform Bam to Sam file and then use a Python script to remove unwanted reads. And then transform Sam to Bam again. But I am wondering if there is a more efficient way, which I mean faster, easier, and memory-efficient, to achieve this goal?Any advice is appreciated!Tao",5,7761,"RNA-Seq, BAM, samtools, Sam","<a rel=""nofollow"" href=""http://broadinstitute.github.io/picard/command-line-overview.html#FilterSamReads"">picard FilterSamReads</a>blockquote>  <strong>READ_LIST_FILE (File)</strong>    Read List File containing reads that will be included or excluded from the OUTPUT SAM or BAM file. Default value: null./blockquote>",10,"analysis, tool",analysis_and_tool
177334,2016-02-16,Is it possible to extract the reference sequence from the BWA index files?,"I have a series of BWA index files ( *.amb *.ann *.bwt, etc) but the original reference fasta sequences are not available. Assuming that it's a complete burrows-wheeler index, the complete reference should be encoded in those indices.Does anyone know if/how the fasta can be re-extracted from them?",3,609,"alignment, bwa","This is an interesting question. It definitely should be possible, so I guess the question may be how to do it with existing tools and the least amount of pain.I looked into it, and it seems that from the ""https://github.com/mruffalo/bwt-sw"" rel=""nofollow"">original bwtsw code</a> (that bwa relies on, particularly for the indexing steps), the ""packed"" fasta file (<code>pac</code>) is the key file to use. This is supported by looking at the order of the indexing substeps of <code>fa2pac</code>, <code>pac2bwt</code>, and finally <code>bwt2sa</code>.So as an informed guess I searched for ""pac2fasta"", and (surprisingly to me) found an existing utility in the ""https://github.com/iontorrent/TMAP/"" rel=""nofollow"">TMAP package</a>. I believe, based on some quick tests, that the binary format for their <code>pac</code> file is the same as bwa uses (and bwtsw), aside from some embedded version numbers. The only catch is that TMAP has a binary annotation file (<code>$ref.tmap.anno</code>) that stores the chromosome names and lengths, whereas bwa uses a plaintext annotation file (<code>$ref.ann</code>). So if this is really what you want to do, it looks like you'll have to hardcode things (that's what I did to test with a small single chromosome reference) or write some code to make a TMAP annotation file from a bam header or bwa <code>.ann</code> file (by working through <code>tmap_refseq_write_header</code> in ""https://github.com/iontorrent/TMAP/blob/master/src/index/tmap_refseq.c"" rel=""nofollow"">tmap_refseq.c</a>).",6,"analysis, tool",analysis_and_tool
